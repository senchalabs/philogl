/*

 Copyright (c) 2011 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){function u(y){return document.getElementById(y)}this.PhiloGL=null;(function(){PhiloGL=function(y,t){function m(a,b,d){var i=a.canvas,n=new PhiloGL.Camera(f.fov,i.width/i.height,f.near,f.far,f);n.update();var s=new PhiloGL.Scene(b,n,j);X=new PhiloGL.WebGL.Application({gl:a,canvas:i,program:b,scene:s,camera:n});b.$$family=="program"&&b.use();h&&PhiloGL.Events.create(X,u.extend(h,{bind:X}));if(g.src.length)new PhiloGL.IO.Textures(u.extend(g,{onComplete:function(){d(X)}}));else d(X)}t=u.merge({context:{},
camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:u.empty,onError:u.empty},t||{});var k=t.context,f=t.camera,h=t.events,g=t.textures,c=u.splat(t.program),j=t.scene;p=PhiloGL.WebGL.getContext(y,k);if(!p){t.onError("The WebGL context couldn't been initialized");return null}var l={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},o=c.length,q=function(){var a=o,b={},d=false;
return{onSuccess:function(i,n){b[n.id||o-a]=i;a--;if(a==0&&!d)m(p,o==1?i:b,function(s){t.onLoad(s)})},onError:function(){a--;t.onError(t.id);d=true}}}();c.forEach(function(a){var b=a.from,d;for(d in l)if(b==d){program=PhiloGL.Program[l[d]](u.extend(q,a));break}if(program)q.onSuccess(program,a)})}})();PhiloGL.unpack=function(y){y=y||window||self;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx"].forEach(function(t){y[t]=PhiloGL[t]})};PhiloGL.version=
"1.2.1";var p,X;u.empty=function(){};u.time=Date.now||function(){return+new Date};u.uid=function(){var y=u.time();return function(){return y++}}();u.extend=function(y,t){for(var m in t)y[m]=t[m];return y};u.type=function(){var y=Object.prototype.toString;return function(t){var m;m=y.call(t);m=m.substr(8,m.length-9).toLowerCase();if(m!="object")return m;if(t.$$family)return t.$$family;return t&&t.nodeName&&t.nodeType==1?"element":m}}();(function(){function y(t){var m=u.type(t);if(m=="object"){m={};
for(var k in t)m[k]=y(t[k]);return m}else if(m=="array"){m=[];k=0;for(var f=t.length;k<f;k++)m[k]=y(t[k]);return m}else return t}u.merge=function(){for(var t={},m=0,k=arguments.length;m<k;m++){var f=arguments[m];if(u.type(f)=="object")for(var h in f){var g=f[h],c=t[h];t[h]=c&&u.type(g)=="object"&&u.type(c)=="object"?u.merge(c,g):y(g)}}return t}})();u.splat=function(){var y=Array.isArray;return function(t){return y(t)&&t||[t]}}();(function(){function y(m){for(var k in m)this[k]=m[k];this.buffers={};
this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var t={getContext:function(m,k){m=typeof m=="string"?u(m):m;var f;(f=m.getContext("experimental-webgl",k))||(f=m.getContext("webgl",k));if(f&&k&&k.debug){p={};for(var h in f){var g=f[h];p[h]=typeof g=="function"?function(c,j){return function(){console.log(c,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var l=j.apply(f,
arguments)}catch(o){throw c+" "+o;}for(var q=[],a;(a=f.getError())!==f.NO_ERROR;)q.push(a);if(q.length)throw q.join();return l}}(h,g):g}}else p=f;if(p)p.get=function(c){return typeof c=="string"?p[c]:c};return p}};y.prototype={$$family:"application",setBuffer:function(m,k,f){if(f===false||f===null){(f=this.bufferMemo[k])&&p.bindBuffer(f.bufferType,null);var h=f&&f.attribute||k;m=m.attributes[h];m!==undefined&&p.disableVertexAttribArray(m)}else{f=u.merge({bufferType:p.ARRAY_BUFFER,size:1,dataType:p.FLOAT,
stride:0,offset:0,drawType:p.STATIC_DRAW},this.bufferMemo[k]||{},f||{});h=f.attribute||k;var g=f.bufferType,c=k in this.buffers,j=c?this.buffers[k]:p.createBuffer(),l="value"in f,o=f.value,q=f.size,a=f.dataType,b=f.stride,d=f.offset,i=f.drawType;m=m.attributes[h];var n=m!==undefined;c||(this.buffers[k]=j);n&&p.enableVertexAttribArray(m);p.bindBuffer(g,j);l&&p.bufferData(g,o,i);n&&p.vertexAttribPointer(m,q,a,false,b,d);delete f.value;this.bufferMemo[k]=f;if(n)this.bufferMemo[h]=f;return this}},setBuffers:function(m,
k){for(var f in k)this.setBuffer(m,f,k[f]);return this},setFrameBuffer:function(m,k){if(typeof k!="object")p.bindFramebuffer(p.FRAMEBUFFER,k?this.frameBuffers[m]:null);else{k=u.merge({width:0,height:0,bindToTexture:false,textureOptions:{attachment:p.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:p.DEPTH_ATTACHMENT}},this.frameBufferMemo[m]||{},k||{});var f=k.bindToTexture,h=k.bindToRenderBuffer,g=m in this.frameBuffers,c=g?this.frameBuffers[m]:p.createFramebuffer(p.FRAMEBUFFER);
p.bindFramebuffer(p.FRAMEBUFFER,c);g||(this.frameBuffers[m]=c);if(f){f=u.merge({data:{width:k.width,height:k.height}},u.type(f)=="object"?f:{});g=m+"-texture";c=k.textureOptions;this.setTexture(g,f);p.framebufferTexture2D(p.FRAMEBUFFER,c.attachment,this.textureMemo[g].textureType,this.textures[g],0)}if(h){h=u.merge({width:k.width,height:k.height},u.type(h)=="object"?h:{});f=m+"-renderbuffer";g=k.renderBufferOptions;this.setRenderBuffer(f,h);p.framebufferRenderbuffer(p.FRAMEBUFFER,g.attachment,p.RENDERBUFFER,
this.renderBuffers[f])}p.bindTexture(p.TEXTURE_2D,null);p.bindRenderbuffer(p.RENDERBUFFER,null);p.bindFramebuffer(p.FRAMEBUFFER,null);this.frameBufferMemo[m]=k;return this}},setFrameBuffers:function(m){for(var k in m)this.setFrameBuffer(k,m[k]);return this},setRenderBuffer:function(m,k){if(typeof k!="object")p.bindRenderbuffer(p.RENDERBUFFER,k?this.renderBufferMemo[m]:null);else{k=u.merge({storageType:p.DEPTH_COMPONENT16,width:0,height:0},this.renderBufferMemo[m]||{},k||{});var f=m in this.renderBuffers,
h=f?this.renderBuffers[m]:p.createRenderbuffer(p.RENDERBUFFER);f||(this.renderBuffers[m]=h);p.bindRenderbuffer(p.RENDERBUFFER,h);p.renderbufferStorage(p.RENDERBUFFER,k.storageType,k.width,k.height);this.renderBufferMemo[m]=k;return this}},setRenderBuffers:function(m){for(var k in m)this.setRenderBuffer(k,m[k]);return this},setTexture:function(m,k){if(!k||typeof k!="object"){p.activeTexture(k||p.TEXTURE0);p.bindTexture(this.textureMemo[m].textureType||p.TEXTURE_2D,this.textures[m])}else{k=u.merge({textureType:p.TEXTURE_2D,
pixelStore:[{name:p.UNPACK_FLIP_Y_WEBGL,value:true}],parameters:[{name:p.TEXTURE_MAG_FILTER,value:p.NEAREST},{name:p.TEXTURE_MIN_FILTER,value:p.NEAREST}],data:{format:p.RGBA,value:false,width:0,height:0,border:0}},this.textureMemo[m]||{},k||{});var f="textureType"in k?k.textureType:p.TEXTURE_2D,h=m in this.textures,g=h?this.textures[m]:p.createTexture(),c=k.pixelStore,j=k.parameters,l=k.data,o=!!k.data.value;h||(this.textures[m]=g);p.bindTexture(f,g);h||c.forEach(function(q){q.name=typeof q.name==
"string"?p[q.name]:q.name;p.pixelStorei(q.name,q.value)});if(o)p.texImage2D(f,0,l.format,l.format,p.UNSIGNED_BYTE,l.value);else if(l.width||l.height)p.texImage2D(f,0,l.format,l.width,l.height,l.border,l.format,p.UNSIGNED_BYTE,null);h||j.forEach(function(q){q.name=p.get(q.name);q.value=p.get(q.value);p.texParameteri(f,q.name,q.value);q.generateMipmap&&p.generateMipmap(f)});delete k.data;this.textureMemo[m]=k;return this}},setTextures:function(m){for(var k in m)this.setTexture(k,m[k]);return this},
use:function(m){p.useProgram(m.program);this.usedProgram=m;return this}};t.Application=y;(function(){try{var m=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(m.getContext("webgl")||m.getContext("experimental-webgl")))}}catch(k){PhiloGL.hasWebGL=function(){return false}}})();PhiloGL.WebGL=t})();(function(){var y=Math.sqrt,t=Math.sin,m=Math.cos,k=Math.tan,f=Math.PI,h=Array.prototype.slice,g=function(a,b,d){this.x=a||0;this.y=b||0;this.z=d||0},c=
{setVec3:function(a,b){a.x=b.x;a.y=b.y;a.z=b.z;return a},set:function(a,b,d,i){a.x=b;a.y=d;a.z=i;return a},add:function(a,b){return new g(a.x+b.x,a.y+b.y,a.z+b.z)},$add:function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a},add2:function(a,b,d){a.x=b.x+d.x;a.y=b.y+d.y;a.z=b.z+d.z;return a},sub:function(a,b){return new g(a.x-b.x,a.y-b.y,a.z-b.z)},$sub:function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;return a},sub2:function(a,b,d){a.x=b.x-d.x;a.y=b.y-d.y;a.z=b.z-d.z;return a},scale:function(a,b){return new g(a.x*
b,a.y*b,a.z*b)},$scale:function(a,b){a.x*=b;a.y*=b;a.z*=b;return a},neg:function(a){return new g(-a.x,-a.y,-a.z)},$neg:function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a},unit:function(a){var b=g.norm(a);if(b>0)return g.scale(a,1/b);return g.clone(a)},$unit:function(a){var b=g.norm(a);if(b>0)return g.$scale(a,1/b);return a},cross:function(a,b){var d=a.x,i=a.y,n=a.z,s=b.x,r=b.y,v=b.z;return new g(i*v-n*r,n*s-d*v,d*r-i*s)},$cross:function(a,b){var d=a.x,i=a.y,n=a.z,s=b.x,r=b.y,v=b.z;a.x=i*v-n*r;a.y=n*
s-d*v;a.z=d*r-i*s;return a},distTo:function(a,b){var d=a.x-b.x,i=a.y-b.y,n=a.z-b.z;return y(d*d,i*i,n*n)},distToSq:function(a,b){var d=a.x-b.x,i=a.y-b.y,n=a.z-b.z;return d*d+i*i+n*n},norm:function(a){var b=a.x,d=a.y;a=a.z;return y(b*b+d*d+a*a)},normSq:function(a){var b=a.x,d=a.y;a=a.z;return b*b+d*d+a*a},dot:function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},clone:function(a){return new g(a.x,a.y,a.z)}},j=g.prototype={},l;for(l in c){g[l]=c[l];j[l]=function(a){return function(){var b=h.call(arguments);
b.unshift(this);return g[a].apply(g,b)}}(l)}var o=function(a,b,d,i,n,s,r,v,w,x,z,D,C,B,E,F){typeof a=="number"?this.set(a,b,d,i,n,s,r,v,w,x,z,D,C,B,E,F):this.id()};c={id:function(a){a.n11=a.n22=a.n33=a.n44=1;a.n12=a.n13=a.n14=0;a.n21=a.n23=a.n24=0;a.n31=a.n32=a.n34=0;a.n41=a.n42=a.n43=0;return a},clone:function(a){return new o(a.n11,a.n12,a.n13,a.n14,a.n21,a.n22,a.n23,a.n24,a.n31,a.n32,a.n33,a.n34,a.n41,a.n42,a.n43,a.n44)},set:function(a,b,d,i,n,s,r,v,w,x,z,D,C,B,E,F,H){a.n11=b;a.n12=d;a.n13=i;a.n14=
n;a.n21=s;a.n22=r;a.n23=v;a.n24=w;a.n31=x;a.n32=z;a.n33=D;a.n34=C;a.n41=B;a.n42=E;a.n43=F;a.n44=H;return a},mulVec3:function(a,b){var d=b.x,i=b.y,n=b.z;return new g(a.n11*d+a.n12*i+a.n13*n+a.n14,a.n21*d+a.n22*i+a.n23*n+a.n24,a.n31*d+a.n32*i+a.n33*n+a.n34)},$mulVec3:function(a,b){var d=b.x,i=b.y,n=b.z;b.x=a.n11*d+a.n12*i+a.n13*n+a.n14;b.y=a.n21*d+a.n22*i+a.n23*n+a.n24;b.z=a.n31*d+a.n32*i+a.n33*n+a.n34;return b},mulMat42:function(a,b,d){var i=b.n11,n=b.n12,s=b.n13,r=b.n14,v=b.n21,w=b.n22,x=b.n23,z=
b.n24,D=b.n31,C=b.n32,B=b.n33,E=b.n34,F=b.n41,H=b.n42,G=b.n43;b=b.n44;var I=d.n11,J=d.n12,K=d.n13,R=d.n14,O=d.n21,L=d.n22,M=d.n23,N=d.n24,S=d.n31,P=d.n32,Q=d.n33,A=d.n34,T=d.n41,W=d.n42,V=d.n43;d=d.n44;a.n11=i*I+n*O+s*S+r*T;a.n12=i*J+n*L+s*P+r*W;a.n13=i*K+n*M+s*Q+r*V;a.n14=i*R+n*N+s*A+r*d;a.n21=v*I+w*O+x*S+z*T;a.n22=v*J+w*L+x*P+z*W;a.n23=v*K+w*M+x*Q+z*V;a.n24=v*R+w*N+x*A+z*d;a.n31=D*I+C*O+B*S+E*T;a.n32=D*J+C*L+B*P+E*W;a.n33=D*K+C*M+B*Q+E*V;a.n34=D*R+C*N+B*A+E*d;a.n41=F*I+H*O+G*S+b*T;a.n42=F*J+H*L+
G*P+b*W;a.n43=F*K+H*M+G*Q+b*V;a.n44=F*R+H*N+G*A+b*d;return a},mulMat4:function(a,b){var d=a.n11,i=a.n12,n=a.n13,s=a.n14,r=a.n21,v=a.n22,w=a.n23,x=a.n24,z=a.n31,D=a.n32,C=a.n33,B=a.n34,E=a.n41,F=a.n42,H=a.n43,G=a.n44,I=b.n11,J=b.n12,K=b.n13,R=b.n14,O=b.n21,L=b.n22,M=b.n23,N=b.n24,S=b.n31,P=b.n32,Q=b.n33,A=b.n34,T=b.n41,W=b.n42,V=b.n43,Y=b.n44,U=new o;U.n11=d*I+i*O+n*S+s*T;U.n12=d*J+i*L+n*P+s*W;U.n13=d*K+i*M+n*Q+s*V;U.n14=d*R+i*N+n*A+s*Y;U.n21=r*I+v*O+w*S+x*T;U.n22=r*J+v*L+w*P+x*W;U.n23=r*K+v*M+w*Q+
x*V;U.n24=r*R+v*N+w*A+x*Y;U.n31=z*I+D*O+C*S+B*T;U.n32=z*J+D*L+C*P+B*W;U.n33=z*K+D*M+C*Q+B*V;U.n34=z*R+D*N+C*A+B*Y;U.n41=E*I+F*O+H*S+G*T;U.n42=E*J+F*L+H*P+G*W;U.n43=E*K+F*M+H*Q+G*V;U.n44=E*R+F*N+H*A+G*Y;return U},$mulMat4:function(a,b){var d=a.n11,i=a.n12,n=a.n13,s=a.n14,r=a.n21,v=a.n22,w=a.n23,x=a.n24,z=a.n31,D=a.n32,C=a.n33,B=a.n34,E=a.n41,F=a.n42,H=a.n43,G=a.n44,I=b.n11,J=b.n12,K=b.n13,R=b.n14,O=b.n21,L=b.n22,M=b.n23,N=b.n24,S=b.n31,P=b.n32,Q=b.n33,A=b.n34,T=b.n41,W=b.n42,V=b.n43,Y=b.n44;a.n11=
d*I+i*O+n*S+s*T;a.n12=d*J+i*L+n*P+s*W;a.n13=d*K+i*M+n*Q+s*V;a.n14=d*R+i*N+n*A+s*Y;a.n21=r*I+v*O+w*S+x*T;a.n22=r*J+v*L+w*P+x*W;a.n23=r*K+v*M+w*Q+x*V;a.n24=r*R+v*N+w*A+x*Y;a.n31=z*I+D*O+C*S+B*T;a.n32=z*J+D*L+C*P+B*W;a.n33=z*K+D*M+C*Q+B*V;a.n34=z*R+D*N+C*A+B*Y;a.n41=E*I+F*O+H*S+G*T;a.n42=E*J+F*L+H*P+G*W;a.n43=E*K+F*M+H*Q+G*V;a.n44=E*R+F*N+H*A+G*Y;return a},add:function(a,b){var d=new o;d.n11=a.n11+b.n11;d.n12=a.n12+b.n12;d.n13=a.n13+b.n13;d.n14=a.n14+b.n14;d.n21=a.n21+b.n21;d.n22=a.n22+b.n22;d.n23=a.n23+
b.n23;d.n24=a.n24+b.n24;d.n31=a.n31+b.n31;d.n32=a.n32+b.n32;d.n33=a.n33+b.n33;d.n34=a.n34+b.n34;d.n41=a.n41+b.n41;d.n42=a.n42+b.n42;d.n43=a.n43+b.n43;d.n44=a.n44+b.n44;return d},$add:function(a,b){a.n11+=b.n11;a.n12+=b.n12;a.n13+=b.n13;a.n14+=b.n14;a.n21+=b.n21;a.n22+=b.n22;a.n23+=b.n23;a.n24+=b.n24;a.n31+=b.n31;a.n32+=b.n32;a.n33+=b.n33;a.n34+=b.n34;a.n41+=b.n41;a.n42+=b.n42;a.n43+=b.n43;a.n44+=b.n44;return a},transpose:function(a){return new o(a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,
a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44)},$transpose:function(a){return o.set(a,a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44)},rotateAxis:function(a,b,d){var i=t(b);b=m(b);var n=1-b,s=d.x,r=d.y;d=d.z;i=new o(s*s*n+b,s*r*n-d*i,s*d*n+r*i,0,r*s*n+d*i,r*r*n+b,r*d*n-s*i,0,s*d*n-r*i,r*d*n+s*i,d*d*n+b,0,0,0,0,1);return o.mulMat4(a,i)},$rotateAxis:function(a,b,d){var i=t(b);b=m(b);var n=1-b,s=d.x,r=d.y;d=d.z;i=new o(s*s*n+b,s*r*n-d*i,s*d*n+r*i,0,r*s*n+
d*i,r*r*n+b,r*d*n-s*i,0,s*d*n-r*i,r*d*n+s*i,d*d*n+b,0,0,0,0,1);return o.$mulMat4(a,i)},rotateXYZ:function(a,b,d,i){b=new o(m(d)*m(i),-m(b)*t(i)+t(b)*t(d)*m(i),t(b)*t(i)+m(b)*t(d)*m(i),0,m(d)*t(i),m(b)*m(i)+t(b)*t(d)*t(i),-t(b)*m(i)+m(b)*t(d)*t(i),0,-t(d),t(b)*m(d),m(b)*m(d),0,0,0,0,1);return o.mulMat4(a,b)},$rotateXYZ:function(a,b,d,i){b=new o(m(d)*m(i),-m(b)*t(i)+t(b)*t(d)*m(i),t(b)*t(i)+m(b)*t(d)*m(i),0,m(d)*t(i),m(b)*m(i)+t(b)*t(d)*t(i),-t(b)*m(i)+m(b)*t(d)*t(i),0,-t(d),t(b)*m(d),m(b)*m(d),0,0,
0,0,1);return o.$mulMat4(a,b)},translate:function(a,b,d,i){b=new o(1,0,0,b,0,1,0,d,0,0,1,i,0,0,0,1);return o.mulMat4(a,b)},$translate:function(a,b,d,i){b=new o(1,0,0,b,0,1,0,d,0,0,1,i,0,0,0,1);return o.$mulMat4(a,b)},scale:function(a,b,d,i){b=new o(b,0,0,0,0,d,0,0,0,0,i,0,0,0,0,1);return o.mulMat4(a,b)},$scale:function(a,b,d,i){b=new o(b,0,0,0,0,d,0,0,0,0,i,0,0,0,0,1);return o.$mulMat4(a,b)},invert:function(a){var b=new o,d=a.n11,i=a.n12,n=a.n13,s=a.n14,r=a.n21,v=a.n22,w=a.n23,x=a.n24,z=a.n31,D=a.n32,
C=a.n33,B=a.n34,E=a.n41,F=a.n42,H=a.n43;a=a.n44;var G=d*v-i*r,I=d*w-n*r,J=d*x-s*r,K=i*w-n*v,R=i*x-s*v,O=n*x-s*w,L=z*F-D*E,M=z*H-C*E,N=z*a-B*E,S=D*H-C*F,P=D*a-B*F,Q=C*a-B*H,A=1/(G*Q-I*P+J*S+K*N-R*M+O*L);b.n11=(+v*Q-w*P+x*S)*A;b.n12=(-i*Q+n*P-s*S)*A;b.n13=(+F*O-H*R+a*K)*A;b.n14=(-D*O+C*R-B*K)*A;b.n21=(-r*Q+w*N-x*M)*A;b.n22=(+d*Q-n*N+s*M)*A;b.n23=(-E*O+H*J-a*I)*A;b.n24=(+z*O-C*J+B*I)*A;b.n31=(+r*P-v*N+x*L)*A;b.n32=(-d*P+i*N-s*L)*A;b.n33=(+E*R-F*J+a*G)*A;b.n34=(-z*R+D*J-B*G)*A;b.n41=(-r*S+v*M-w*L)*A;
b.n42=(+d*S-i*M+n*L)*A;b.n43=(-E*K+F*I-H*G)*A;b.n44=(+z*K-D*I+C*G)*A;return b},$invert:function(a){var b=a.n11,d=a.n12,i=a.n13,n=a.n14,s=a.n21,r=a.n22,v=a.n23,w=a.n24,x=a.n31,z=a.n32,D=a.n33,C=a.n34,B=a.n41,E=a.n42,F=a.n43,H=a.n44,G=b*r-d*s,I=b*v-i*s,J=b*w-n*s,K=d*v-i*r,R=d*w-n*r,O=i*w-n*v,L=x*E-z*B,M=x*F-D*B,N=x*H-C*B,S=z*F-D*E,P=z*H-C*E,Q=D*H-C*F,A=1/(G*Q-I*P+J*S+K*N-R*M+O*L);a.n11=(+r*Q-v*P+w*S)*A;a.n12=(-d*Q+i*P-n*S)*A;a.n13=(+E*O-F*R+H*K)*A;a.n14=(-z*O+D*R-C*K)*A;a.n21=(-s*Q+v*N-w*M)*A;a.n22=
(+b*Q-i*N+n*M)*A;a.n23=(-B*O+F*J-H*I)*A;a.n24=(+x*O-D*J+C*I)*A;a.n31=(+s*P-r*N+w*L)*A;a.n32=(-b*P+d*N-n*L)*A;a.n33=(+B*R-E*J+H*G)*A;a.n34=(-x*R+z*J-C*G)*A;a.n41=(-s*S+r*M-v*L)*A;a.n42=(+b*S-d*M+i*L)*A;a.n43=(-B*K+E*I-F*G)*A;a.n44=(+x*K-z*I+D*G)*A;return a},lookAt:function(a,b,d,i){d=g.sub(b,d);d.$unit();i=g.cross(i,d);i.$unit();var n=g.cross(d,i);n.$unit();return o.set(a,i.x,i.y,i.z,-i.dot(b),n.x,n.y,n.z,-n.dot(b),d.x,d.y,d.z,-d.dot(b),0,0,0,1)},frustum:function(a,b,d,i,n,s,r){return o.set(a,2*s/
(d-b),0,(d+b)/(d-b),0,0,2*s/(n-i),(n+i)/(n-i),0,0,0,-(r+s)/(r-s),-2*r*s/(r-s),0,0,-1,0)},perspective:function(a,b,d,i,n){b=i*k(b*f/360);var s=-b;return o.frustum(a,s*d,b*d,s,b,i,n)},ortho:function(a,b,d,i,n,s,r){var v=d-b,w=n-i,x=r-s;return o.set(a,2/v,0,0,-((d+b)/v),0,2/w,0,-((n+i)/w),0,0,-2/x,-((r+s)/x),0,0,0,1)},toFloat32Array:function(a){return new Float32Array([a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44])}};j=o.prototype={};for(l in c){o[l]=
c[l];j[l]=function(a){return function(){var b=h.call(arguments);b.unshift(this);return o[a].apply(o,b)}}(l)}var q=function(a,b,d,i){this.x=a||0;this.y=b||0;this.z=d||0;this.w=i||0};c={setQuat:function(a,b){a.x=b.x;a.y=b.y;a.z=b.z;a.w=b.w;return a},set:function(a,b,d,i,n){a.x=b||0;a.y=d||0;a.z=i||0;a.w=n||0;return a},clone:function(a){return new q(a.x,a.y,a.z,a.w)},neg:function(a){return new q(-a.x,-a.y,-a.z,-a.w)},$neg:function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;a.w=-a.w;return a},add:function(a,b){return new q(a.x+
b.x,a.y+b.y,a.z+b.z,a.w+b.w)},$add:function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;a.w+=b.w;return a},sub:function(a,b){return new q(a.x-b.x,a.y-b.y,a.z-b.z,a.w-b.w)},$sub:function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;a.w-=b.w;return a},scale:function(a,b){return new q(a.x*b,a.y*b,a.z*b,a.w*b)},$scale:function(a,b){a.x*=b;a.y*=b;a.z*=b;a.w*=b;return a},mulQuat:function(a,b){var d=a.x,i=a.y,n=a.z,s=a.w,r=b.x,v=b.y,w=b.z,x=b.w;return new q(s*r+d*x+i*w-n*v,s*v+i*x+n*r-d*w,s*w+n*x+d*v-i*r,s*x-d*r-i*v-n*w)},$mulQuat:function(a,
b){var d=a.x,i=a.y,n=a.z,s=a.w,r=b.x,v=b.y,w=b.z,x=b.w;a.a=s*r+d*x+i*w-n*v;a.b=s*v+i*x+n*r-d*w;a.c=s*w+n*x+d*v-i*r;a.d=s*x-d*r-i*v-n*w;return a},divQuat:function(a,b){var d=a.x,i=a.y,n=a.z,s=a.w,r=b.x,v=b.y,w=b.z,x=b.w,z=1/(x*x+r*r+v*v+w*w);return new q((d*x-s*r-i*w+n*v)*z,(d*w-s*v+i*x-n*r)*z,(i*r+n*x-s*w-d*v)*z,(s*x+d*r+i*v+n*w)*z)},$divQuat:function(a,b){var d=a.x,i=a.y,n=a.z,s=a.w,r=b.x,v=b.y,w=b.z,x=b.w,z=1/(x*x+r*r+v*v+w*w);a.a=(d*x-s*r-i*w+n*v)*z;a.b=(d*w-s*v+i*x-n*r)*z;a.c=(i*r+n*x-s*w-d*v)*
z;a.d=(s*x+d*r+i*v+n*w)*z;return a},invert:function(a){var b=a.x,d=a.y,i=a.z;a=a.w;var n=1/(b*b+d*d+i*i+a*a);return new q(-b*n,-d*n,-i*n,a*n)},$invert:function(a){var b=a.x,d=a.y,i=a.z,n=a.w,s=1/(b*b+d*d+i*i+n*n);a.a=-b*s;a.b=-d*s;a.c=-i*s;a.d=n*s;return a},norm:function(a){var b=a.x,d=a.y,i=a.z;a=a.w;return y(b*b+d*d+i*i+a*a)},normSq:function(a){var b=a.x,d=a.y,i=a.z;a=a.w;return b*b+d*d+i*i+a*a},unit:function(a){return q.scale(a,1/q.norm(a))},$unit:function(a){return q.$scale(a,1/q.norm(a))},conjugate:function(a){return new q(-a.x,
-a.y,-a.z,a.w)},$conjugate:function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a}};j=q.prototype={};for(l in c){q[l]=c[l];j[l]=function(a){return function(){var b=h.call(arguments);b.unshift(this);return q[a].apply(q,b)}}(l)}g.fromQuat=function(a){return new g(a.x,a.y,a.z)};q.fromVec3=function(a,b){return new q(a.x,a.y,a.z,b||0)};q.fromMat4=function(a){var b,d,i;if(a.n11>a.n22&&a.n11>a.n33){b=0;d=1;i=2}else if(a.n22>a.n11&&a.n22>a.n33){b=1;d=2;i=0}else{b=2;d=0;i=1}var n=y(1+a["n"+b+""+b]-a["n"+d+""+d]-
a["n"+i+""+i]),s=new q,r=["x","y","z"];s[r[b]]=0.5*n;s[r[d]]=0.5*(a["n"+d+""+b]+a["n"+b+""+d])/n;s[r[i]]=0.5*(a["n"+b+""+i]+a["n"+i+""+b])/n;s.w=0.5*(a["n"+d+""+i]-a["n"+i+""+d])/n;return s};q.fromXRotation=function(a){return new q(t(a/2),0,0,m(a/2))};q.fromYRotation=function(a){return new q(0,t(a/2),0,m(a/2))};q.fromZRotation=function(a){return new q(0,0,t(a/2),m(a/2))};q.fromAxisRotation=function(a,b){var d=a.x,i=a.y,n=a.z,s=1/y(d*d+i*i+n*n),r=t(b/2),v=m(b/2);return new q(r*d*s,r*i*s,r*n*s,v)};
o.fromQuat=function(a){var b=a.w,d=a.x,i=a.y;a=a.z;return new o(b*b+d*d-i*i-a*a,2*d*i-2*b*a,2*d*a+2*b*i,0,2*d*i+2*b*a,b*b-d*d+i*i-a*a,2*i*a-2*b*d,0,2*d*a-2*b*i,2*i*a+2*b*d,b*b-d*d-i*i+a*a,0,0,0,0,1)};PhiloGL.Vec3=g;PhiloGL.Mat4=o;PhiloGL.Quat=q})();(function(){function y(h){return h!==true?h:false}var t=function(h){var g=function(c){for(var j={x:0,y:0};c&&!/^(?:body|html)$/i.test(c.tagName);){j.x+=c.offsetLeft;j.y+=c.offsetTop;c=c.offsetParent}return j}(h);h=function(c){for(var j={x:0,y:0};c&&!/^(?:body|html)$/i.test(c.tagName);){j.x+=
c.scrollLeft;j.y+=c.scrollTop;c=c.parentNode}return j}(h);return{x:g.x-h.x,y:g.y-h.y}},m={get:function(h,g){return h||(g||window).event},getWheel:function(h){return h.wheelDelta?h.wheelDelta/120:-(h.detail||0)/3},getKey:function(h){var g=h.which||h.keyCode,c;a:{c=f.Keys;for(var j in c)if(c[j]==g){c=j;break a}c=void 0}j=g-111;if(j>0&&j<13)c="f"+j;c=c||String.fromCharCode(g).toLowerCase();return{code:g,key:c,shift:h.shiftKey,control:h.ctrlKey,alt:h.altKey,meta:h.metaKey}},isRightClick:function(h){return h.which==
3||h.button==2},getPos:function(h,g){g=g||window;h=h||g.event;var c=g.document;c=c.documentElement||c.body;if(h.touches&&h.touches.length)h=h.touches[0];return{x:h.pageX||h.clientX+c.scrollLeft,y:h.pageY||h.clientY+c.scrollTop}},stop:function(h){h.stopPropagation&&h.stopPropagation();h.cancelBubble=true;if(h.preventDefault)h.preventDefault();else h.returnValue=false}},k=function(h,g){var c=h.canvas;this.scene=h.scene;this.domElem=c;this.pos=t(c);this.opt=this.callbacks=g;this.size={width:c.width||
c.offsetWidth,height:c.height||c.offsetHeight};this.attachEvents()};k.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var h=this.domElem,g=this;if(this.opt.disableContextMenu)h.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"].forEach(function(j){h.addEventListener(j,function(l,o){g[j](g.eventInfo(j,l,o))},false)});["keydown","keyup"].forEach(function(j){document.addEventListener(j,
function(l,o){g[j](g.eventInfo(j,l,o))},false)});var c="";c=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";h.addEventListener(c,function(j,l){g.mousewheel(g.eventInfo("mousewheel",j,l))},false)},eventInfo:function(h,g,c){var j=this.domElem,l=this.scene,o=this.opt,q=this.getSize(),a=o.relative,b=o.centerOrigin,d=o.cachePosition&&this.pos||t(j),i=m.get(g,c),n=m.getPos(g,c);g={};c=n.x;j=n.y;if(a){c-=d.x;j-=d.y;if(b){c-=q.width/2;j-=q.height/2;j*=-1}}switch(h){case "mousewheel":g.wheel=
m.getWheel(i);break;case "keydown":u.extend(g,m.getKey(i));break;case "mouseup":g.isRightClick=m.isRightClick(i)}var s;u.extend(g,{x:c,y:j,cache:false,stop:function(){m.stop(i)},getTarget:function(){if(s)return s;return s=!o.picking||l.pick(n.x-d.x,n.y-d.y)||true}});g.event=i;return g},getSize:function(){if(this.cacheSize)return this.size;var h=this.domElem;return{width:h.width||h.offsetWidth,height:h.height||h.offsetHeight}},mouseup:function(h){if(!this.moved)if(h.isRightClick)this.callbacks.onRightClick(h,
this.hovered);else this.callbacks.onClick(h,y(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(h,y(this.pressed));else this.callbacks.onDragCancel(h,y(this.pressed));this.pressed=this.moved=false}},mouseout:function(h){for(var g=h.relatedTarget,c=this.domElem;g&&g.parentNode;){if(c==g.parentNode)return;g=g.parentNode}if(this.hovered){this.callbacks.onMouseLeave(h,this.hovered);this.hovered=false}},mouseover:function(){},mousemove:function(h){if(this.pressed){this.moved=true;
this.callbacks.onDragMove(h,y(this.pressed))}else if(this.hovered){var g=y(h.getTarget());if(this.hovered!=g){this.callbacks.onMouseLeave(h,this.hovered);if(this.hovered=g)this.callbacks.onMouseEnter(h,this.hovered)}else this.callbacks.onMouseMove(h,this.hovered)}else if(this.hovered=y(h.getTarget()))this.callbacks.onMouseEnter(h,this.hovered)},mousewheel:function(h){this.callbacks.onMouseWheel(h)},mousedown:function(h){this.pressed=h.getTarget();this.callbacks.onDragStart(h,y(this.pressed))},touchstart:function(h){this.touched=
h.getTarget();this.callbacks.onTouchStart(h,y(this.touched))},touchmove:function(h){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(h,y(this.touched))}},touchend:function(h){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(h,y(this.touched));else this.callbacks.onTouchCancel(h,y(this.touched));this.touched=this.touchMoved=false}},keydown:function(h){this.callbacks.onKeyDown(h)},keyup:function(h){this.callbacks.onKeyUp(h)}};var f={};f.create=function(h,g){g=u.merge({cachePosition:true,
cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,onClick:u.empty,onRightClick:u.empty,onDragStart:u.empty,onDragMove:u.empty,onDragEnd:u.empty,onDragCancel:u.empty,onTouchStart:u.empty,onTouchMove:u.empty,onTouchEnd:u.empty,onTouchCancel:u.empty,onMouseMove:u.empty,onMouseEnter:u.empty,onMouseLeave:u.empty,onMouseWheel:u.empty,onKeyDown:u.empty,onKeyUp:u.empty},g||{});var c=g.bind;if(c)for(var j in g)j.match(/^on[a-zA-Z0-9]+$/)&&function(l,o){g[l]=function(){return o.apply(c,
Array.prototype.slice.call(arguments))}}(j,g[j]);new k(h,g)};f.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};PhiloGL.Events=f})();(function(){function y(){return arguments.length==2?{vs:arguments[0],fs:arguments[1]}:arguments[0]||{}}var t=function(f,h,g){var c=f.createShader(g);if(c==null)throw"Error creating the shader with shader type: "+g;f.shaderSource(c,h);f.compileShader(c);if(!f.getShaderParameter(c,f.COMPILE_STATUS)){h=f.getShaderInfoLog(c);f.deleteShader(c);
throw"Error while compiling the shader "+h;}return c},m=function(f,h,g){var c=p.getUniformLocation(f,h.name);f=h.type;if(h.size>1&&g)switch(f){case p.FLOAT:return function(j){p.uniform1fv(c,new Float32Array(j))};case p.INT:case p.BOOL:return function(j){p.uniform1iv(c,new Uint16Array(j))}}switch(f){case p.FLOAT:return function(j){p.uniform1f(c,j)};case p.FLOAT_VEC2:return function(j){p.uniform2fv(c,new Float32Array(j))};case p.FLOAT_VEC3:return function(j){p.uniform3fv(c,new Float32Array(j))};case p.FLOAT_VEC4:return function(j){p.uniform4fv(c,
new Float32Array(j))};case p.INT:case p.BOOL:case p.SAMPLER_2D:case p.SAMPLER_CUBE:return function(j){p.uniform1i(c,j)};case p.INT_VEC2:case p.BOOL_VEC2:return function(j){p.uniform2iv(c,new Uint16Array(j))};case p.INT_VEC3:case p.BOOL_VEC3:return function(j){p.uniform3iv(c,new Uint16Array(j))};case p.INT_VEC4:case p.BOOL_VEC4:return function(j){p.uniform4iv(c,new Uint16Array(j))};case p.FLOAT_MAT2:return function(j){p.uniformMatrix2fv(c,false,j.toFloat32Array())};case p.FLOAT_MAT3:return function(j){p.uniformMatrix3fv(c,
false,j.toFloat32Array())};case p.FLOAT_MAT4:return function(j){p.uniformMatrix4fv(c,false,j.toFloat32Array())}}throw"Unknown type: "+f;},k=function(f,h){var g=p,c=g.createProgram();g.attachShader(c,t(g,f,g.VERTEX_SHADER));g.attachShader(c,t(g,h,g.FRAGMENT_SHADER));g.linkProgram(c);if(!g.getProgramParameter(c,g.LINK_STATUS))throw"Error linking the shader: "+g.getProgramInfoLog(c);if(!c)return false;g={};for(var j={},l=p.getProgramParameter(c,p.ACTIVE_ATTRIBUTES),o=0;o<l;o++){var q=p.getActiveAttrib(c,
o),a=q.name;q=p.getAttribLocation(c,q.name);g[a]=q}l=p.getProgramParameter(c,p.ACTIVE_UNIFORMS);for(o=0;o<l;o++){q=p.getActiveUniform(c,o);a=q.name;a=a[a.length-1]=="]"?a.substr(0,a.length-3):a;j[a]=m(c,q,q.name!=a)}this.program=c;this.attributes=g;this.uniforms=j};k.prototype={$$family:"program",setUniform:function(f,h){if(this.uniforms[f])this.uniforms[f](h);return this},setUniforms:function(f){for(var h in f)this.setUniform(h,f[h]);return this}};["setBuffer","setBuffers","use"].forEach(function(f){k.prototype[f]=
function(){var h=Array.prototype.slice.call(arguments);h.unshift(this);X[f].apply(X,h);return this}});["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture","setTextures"].forEach(function(f){k.prototype[f]=function(){X[f].apply(X,arguments);return this}});k.fromShaderIds=function(){var f=y.apply({},arguments),h=u(f.vs);f=u(f.fs);return new k(h.innerHTML,f.innerHTML)};k.fromShaderSources=function(f){f=y.apply({},arguments);return new k(f.vs,f.fs)};k.fromDefaultShaders=
function(){var f=y.apply({},arguments),h=PhiloGL.Shaders;return PhiloGL.Program.fromShaderSources(h.Vertex[f.vs||"Default"],h.Fragment[f.fs||"Default"])};k.fromShaderURIs=function(f){f=u.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:u.empty,onError:u.empty},f||{});var h=f.path+f.fs,g=PhiloGL.IO.XHR;(new g({url:f.path+f.vs,noCache:f.noCache,onError:function(c){f.onError(c)},onSuccess:function(c){(new g({url:h,noCache:f.noCache,onError:function(j){f.onError(j)},onSuccess:function(j){f.onSuccess(k.fromShaderSources(c,
j),f)}})).send()}})).send()};PhiloGL.Program=k})();(function(){var y={},t=function(f){this.opt=f=u.merge({url:"http://sencha.com/",method:"GET",async:true,noCache:false,sendAsBinary:false,onProgress:u.empty,onSuccess:u.empty,onError:u.empty,onAbort:u.empty,onComplete:u.empty},f||{});this.initXHR()};t.State={};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(f,h){t.State[f]=h});t.prototype={initXHR:function(){var f=this.req=new XMLHttpRequest,h=this;["Progress","Error",
"Abort","Load"].forEach(function(g){f.addEventListener(g.toLowerCase(),function(c){h["handle"+g](c)},false)})},send:function(f){var h=this.req,g=this.opt,c=g.async;if(g.noCache)g.url+=(g.url.indexOf("?")>=0?"&":"?")+u.uid();h.open(g.method,g.url,c);if(c)h.onreadystatechange=function(){if(h.readyState==t.State.COMPLETED)if(h.status==200)g.onSuccess(h.responseText);else g.onError(h.status)};g.sendAsBinary?h.sendAsBinary(f||g.body||null):h.send(f||g.body||null);if(!c)if(h.status==200)g.onSuccess(h.responseText);
else g.onError(h.status)},setRequestHeader:function(f,h){this.req.setRequestHeader(f,h);return this},handleProgress:function(f){if(f.lengthComputable)this.opt.onProgress(f,Math.round(f.loaded/f.total*100));else this.opt.onProgress(f,-1)},handleError:function(f){this.opt.onError(f)},handleAbort:function(){this.opt.onAbort(e)},handleLoad:function(f){this.opt.onComplete(f)}};var m=function(f){f=u.merge({url:"http://sencha.com/",data:{},noCache:false,onComplete:u.empty,callbackKey:"callback"},f||{});
var h=m.counter++,g=[],c;for(c in f.data)g.push(c+"="+f.data[c]);g=g.join("&");if(f.noCache)g+=(g.indexOf("?")>=0?"&":"?")+u.uid();g=f.url+(f.url.indexOf("?")>-1?"&":"?")+f.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+h+(g.length>0?"&"+g:"");var j=document.createElement("script");j.type="text/javascript";j.src=g;m.requests["request_"+h]=function(l){f.onComplete(l);j.parentNode&&j.parentNode.removeChild(j);j.clearAttributes&&j.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(j)};
m.counter=0;m.requests={};var k=function(f){f=u.merge({src:[],noCache:false,onProgress:u.empty,onComplete:u.empty},f||{});var h=0,g=f.src.length,c=function(){f.onProgress(Math.round(++h/g*100));if(h==g)f.onComplete(q)},j=function(){if(++h==g)f.onComplete(q)},l=f.noCache,o=u.uid(),q=f.src.map(function(a,b){var d=new Image;d.index=b;d.onload=c;d.onerror=j;d.src=a+(l?(a.indexOf("?")>=0?"&":"?")+o:"");return d});return q};y.XHR=t;y.JSONP=m;y.Images=k;y.Textures=function(f){f=u.merge({src:[],noCache:false,
onComplete:u.empty},f||{});k({src:f.src,noCache:f.noCache,onComplete:function(h){var g={};h.forEach(function(c,j){g[f.src[j]]=u.merge({data:{value:c}},f)});X.setTextures(g);f.onComplete()}})};PhiloGL.IO=y})();(function(){var y=PhiloGL.Vec3,t=PhiloGL.Mat4,m=function(k,f,h,g,c){c=c||{};var j=c.position,l=c.target;c=c.up;this.fov=k;this.near=h;this.far=g;this.aspect=f;this.position=j&&new y(j.x,j.y,j.z)||new y;this.target=l&&new y(l.x,l.y,l.z)||new y;this.up=c&&new y(c.x,c.y,c.z)||new y(0,1,0);this.projection=
(new t).perspective(k,f,h,g);this.modelView=new t};m.prototype={update:function(){this.projection=(new t).perspective(this.fov,this.aspect,this.near,this.far);this.modelView.lookAt(this.position,this.target,this.up)}};PhiloGL.Camera=m})();(function(){var y=PhiloGL.Vec3,t=PhiloGL.Mat4,m=Math.cos,k=Math.sin,f=Math.PI,h=function(c){if(c&&c.length&&u.type(c[0])=="array")return[].concat.apply([],c);return c},g={};g.Model=function(c){c=c||{};this.id=c.id||u.uid();this.pickable=!!c.pickable;this.pick=c.pick||
function(){return false};if(c.pickingColors)this.pickingColors=h(c.pickingColors);this.vertices=h(c.vertices);this.normals=h(c.normals);this.textures=c.textures&&u.splat(c.textures);this.colors=h(c.colors);this.indices=h(c.indices);this.shininess=c.shininess||0;if(c.texCoords)this.texCoords=u.type(c.texCoords)=="object"?c.texCoords:h(c.texCoords);this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=c.drawType;this.display="display"in c?c.display:true;this.onBeforeRender=
c.onBeforeRender||u.empty;this.onAfterRender=c.onAfterRender||u.empty;if(c.program)this.program=c.program;this.position=new y;this.rotation=new y;this.scale=new y(1,1,1);this.matrix=new t;this.normalizeColors();c.computeCentroids&&this.computeCentroids();c.computeNormals&&this.computeNormals()};g.Model.prototype={$$family:"model",update:function(){var c=this.matrix,j=this.position,l=this.rotation,o=this.scale;c.id();c.$translate(j.x,j.y,j.z);c.$rotateXYZ(l.x,l.y,l.z);c.$scale(o.x,o.y,o.z)},toFloat32Array:function(c){return new Float32Array(this[c])},
toUint16Array:function(c){return new Uint16Array(this[c])},normalizeColors:function(){if(this.vertices){var c=this.vertices.length*4/3;if(this.colors&&this.colors.length<c)for(var j=c/this.colors.length,l=this.colors,o=l.slice();--j;)l.push.apply(l,o);if(this.pickingColors&&this.pickingColors.length<c){j=c/this.pickingColors.length;c=this.pickingColors;for(l=c.slice();--j;)c.push.apply(c,l)}}},computeCentroids:function(){var c=this.vertices,j=[];this.faces.forEach(function(l){var o=[0,0,0],q=0;l.forEach(function(a){a=
c[a];o[0]+=a[0];o[1]+=a[1];o[2]+=a[2];q++});o[0]/=q;o[1]/=q;o[2]/=q;j.push(o)});this.centroids=j},computeNormals:function(){var c=this.vertices,j=[];this.faces.forEach(function(l){var o=c[l[0]],q=c[l[1]];l=c[l[2]];o={x:o[0]-q[0],y:o[1]-q[1],z:o[2]-q[2]};y.$cross(o,{x:l[0]-q[0],y:l[1]-q[1],z:l[1]-q[2]});y.norm(o)>1.0E-6&&y.unit(o);j.push([o.x,o.y,o.z])});this.normals=j}};u.extend(g.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){var j=this.attributes,
l;for(l in j){var o=j[l],q=this.id+"-"+l;if(Object.keys(o).length){o.attribute=l;c.setBuffer(q,o);delete o.value}else c.setBuffer(q,true)}},unsetAttributes:function(c){var j=this.attributes,l;for(l in j)c.setBuffer(this.id+"-"+l,false)},setShininess:function(c){c.setUniform("shininess",this.shininess||0)},setVertices:function(c,j){if(this.vertices)j||this.dynamic?c.setBuffer("vertices-"+this.id,{attribute:"position",value:this.toFloat32Array("vertices"),size:3}):c.setBuffer("vertices-"+this.id)},
unsetVertices:function(c){c.setBuffer("vertices-"+this.id,false)},setNormals:function(c,j){if(this.normals)j||this.dynamic?c.setBuffer("normals-"+this.id,{attribute:"normal",value:this.toFloat32Array("normals"),size:3}):c.setBuffer("normals-"+this.id)},unsetNormals:function(c){c.setBuffer("normals-"+this.id,false)},setIndices:function(c,j){if(this.indices)j||this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:p.ELEMENT_ARRAY_BUFFER,drawType:p.STATIC_DRAW,value:this.toUint16Array("indices"),size:1}):
c.setBuffer("indices-"+this.id)},unsetIndices:function(c){c.setBuffer("indices-"+this.id,false)},setPickingColors:function(c,j){if(this.pickingColors)j||this.dynamic?c.setBuffer("pickingColors-"+this.id,{attribute:"pickingColor",value:this.toFloat32Array("pickingColors"),size:4}):c.setBuffer("pickingColors-"+this.id)},unsetPickingColors:function(c){c.setBuffer("pickingColors-"+this.id,false)},setColors:function(c,j){if(this.colors)j||this.dynamic?c.setBuffer("colors-"+this.id,{attribute:"color",value:this.toFloat32Array("colors"),
size:4}):c.setBuffer("colors-"+this.id)},unsetColors:function(c){c.setBuffer("colors-"+this.id,false)},setTexCoords:function(c,j){if(this.texCoords){var l=this.id;if(j||this.dynamic)u.type(this.texCoords)=="object"?this.textures.forEach(function(o,q){c.setBuffer("texCoords-"+q+"-"+l,{attribute:"texCoord"+(q+1),value:new Float32Array(this.texCoords[o]),size:2})}):c.setBuffer("texCoords-"+l,{attribute:"texCoord1",value:this.toFloat32Array("texCoords"),size:2});else u.type(this.texCoords)=="object"?
this.textures.forEach(function(o,q){c.setBuffer("texCoords-"+q+"-"+l)}):c.setBuffer("texCoords-"+l)}},unsetTexCoords:function(c){c.setBuffer("texCoords-"+this.id,false)},setTextures:function(c){this.textures=this.textures?u.splat(this.textures):[];for(var j=0,l=this.textures,o=l.length,q=PhiloGL.Scene.MAX_TEXTURES;j<q;j++)if(j<o){c.setUniform("hasTexture"+(j+1),true);c.setUniform("sampler"+(j+1),j);c.setTexture(l[j],p["TEXTURE"+j])}else c.setUniform("hasTexture"+(j+1),false)}});g.Cube=function(c){g.Model.call(this,
u.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,
4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};g.Cube.prototype=Object.create(g.Model.prototype);g.Sphere=function(c){var j=c.nlat||10,l=c.nlong||10,o=c.radius||1,q=c.startLat||0,a=(c.endLat||f)-q,b=c.startLong||0,d=(c.endLong||2*f)-b,i=[],n=[],s=[],r=[];if(typeof o=="number"){var v=o;o=function(){return v}}for(var w=0;w<=j;w++)for(var x=0;x<=l;x++){var z=x/l,D=w/j,C=d*z+b,B=a*D+q,E=k(C),F=m(C);C=k(B);var H=m(B);B=F*C;F=H;E*=C;C=o(B,F,E,z,D);i.push(C*B,C*F,C*
E);n.push(B,F,E);s.push(z,D)}o=j+1;for(x=0;x<j;x++)for(w=0;w<l;w++){r.push(w*o+x,w*o+x+1,(w+1)*o+x);r.push((w+1)*o+x,w*o+x+1,(w+1)*o+x+1)}g.Model.call(this,u.extend({vertices:i,indices:r,normals:n,texCoords:s},c||{}))};g.Sphere.prototype=Object.create(g.Model.prototype);g.IcoSphere=function(c){var j=c.iterations||0,l=[],o=[],q=[],a=[],b=Math.sqrt,d=Math.acos,i=Math.atan2,n=Math.PI,s=n*2;c.onAddVertex=c.onAddVertex||u.empty;var r=(1+b(5))/2,v=b(1+r*r);l.push(-1/v,r/v,0,1/v,r/v,0,-1/v,-r/v,0,1/v,-r/
v,0,0,-1/v,r/v,0,1/v,r/v,0,-1/v,-r/v,0,1/v,-r/v,r/v,0,-1/v,r/v,0,1/v,-r/v,0,-1/v,-r/v,0,1/v);q.push(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1);var w=function(){var Q={};return function(A,T){A*=3;T*=3;var W=(A<T?A:T)+"|"+(A>T?A:T);if(W in Q)return Q[W];var V=(l[A]+l[T])/2,Y=(l[A+1]+l[T+1])/2,U=(l[A+2]+l[T+2])/2,Z=b(V*V+Y*Y+U*U);V/=Z;Y/=Z;U/=Z;l.push(V,Y,U);return Q[W]=l.length/3-1}}();for(r=0;r<j;r++){var x=[],
z=0;for(v=q.length;z<v;z+=3){var D=w(q[z],q[z+1]),C=w(q[z+1],q[z+2]),B=w(q[z+2],q[z]);x.push(q[z],D,B,q[z+1],C,D,q[z+2],B,C,D,C,B)}q=x}r=0;for(v=q.length;r<v;r+=3){z=q[r];D=q[r+1];C=q[r+2];j=z*3;w=D*3;x=C*3;z*=2;D*=2;C*=2;B=l[j];var E=l[j+1],F=l[j+2],H=d(F/b(B*B+E*E+F*F)),G=i(E,B);H/=n;G=1-G/s;var I=l[w],J=l[w+1],K=l[w+2],R=d(K/b(I*I+J*J+K*K)),O=i(J,I);R/=n;O=1-O/s;var L=l[x],M=l[x+1],N=l[x+2],S=d(N/b(L*L+M*M+N*N)),P=i(M,L);S/=n;P=1-P/s;B=y.cross({x:L-I,y:M-J,z:N-K},{x:B-I,y:E-J,z:F-K}).$unit();o[j]=
o[w]=o[x]=B.x;o[j+1]=o[w+1]=o[x+1]=B.y;o[j+2]=o[w+2]=o[x+2]=B.z;a[z]=G;a[z+1]=H;a[D]=O;a[D+1]=R;a[C]=P;a[C+1]=S}g.Model.call(this,u.extend({vertices:l,indices:q,normals:o,texCoords:a},c||{}))};g.IcoSphere.prototype=Object.create(g.Model.prototype);g.TruncatedCone=function(c){var j=c.bottomRadius||0,l=c.topRadius||0,o=c.height||1,q=c.nradial||10,a=c.nvertical||10,b=!!c.topCap,d=!!c.bottomCap,i=(b?2:0)+(d?2:0),n=[],s=[],r=[],v=[],w=q+1,x=Math.atan2(j-l,o),z=Math,D=z.sin,C=z.cos;z=z.PI;var B=C(x);x=
D(x);d=a+(d?2:0);for(b=b?-2:0;b<=d;b++){var E=b/a,F=o*E,H;if(b<0){F=0;E=1;H=j}else if(b>a){F=o;E=1;H=l}else H=j+(l-j)*(b/a);if(b==-2||b==a+2)E=H=0;F-=o/2;for(var G=0;G<w;G++){var I=D(G*z*2/q),J=C(G*z*2/q);n.push(I*H,F,J*H);s.push(b<0||b>a?0:I*B,b<0?-1:b>a?1:x,b<0||b>a?0:J*B);r.push(G/q,E)}}for(b=0;b<a+i;b++)for(G=0;G<q;G++)v.push(w*(b+0)+0+G,w*(b+0)+1+G,w*(b+1)+1+G,w*(b+0)+0+G,w*(b+1)+1+G,w*(b+1)+0+G);g.Model.call(this,u.extend({vertices:n,normals:s,texCoords:r,indices:v},c||{}))};g.TruncatedCone.prototype=
Object.create(g.Model.prototype);g.Cone=function(c){c.topRadius=0;c.topCap=!!c.cap;c.bottomCap=!!c.cap;c.bottomRadius=c.radius||3;g.TruncatedCone.call(this,c)};g.Cone.prototype=Object.create(g.TruncatedCone.prototype);g.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=c.radius;g.TruncatedCone.call(this,c)};g.Cylinder.prototype=Object.create(g.TruncatedCone.prototype);g.Plane=function(c){var j=c.type,l=j.split(","),o=c[l[0]+"len"],q=c[l[1]+"len"],a=c["n"+l[0]]||1;l=c["n"+l[1]]||1;var b=c.offset;
numVertices=(a+1)*(l+1);positions=[];normals=[];texCoords=[];for(var d=0;d<=l;d++)for(var i=0;i<=a;i++){var n=i/a,s=d/l;texCoords.push(n,s);switch(j){case "x,y":positions.push(o*n-o*0.5,q*s-q*0.5,b);normals.push(0,0,1);break;case "x,z":positions.push(o*n-o*0.5,b,q*s-q*0.5);normals.push(0,1,0);break;case "y,z":positions.push(b,o*n-o*0.5,q*s-q*0.5);normals.push(1,0,0)}}j=a+1;o=[];for(d=0;d<l;d++)for(i=0;i<a;i++){o.push((d+0)*j+i,(d+1)*j+i,(d+0)*j+i+1);o.push((d+1)*j+i,(d+1)*j+i+1,(d+0)*j+i+1)}g.Model.call(this,
u.extend({vertices:positions,normals:normals,texCoords:texCoords,indices:o},c))};g.Plane.prototype=Object.create(g.Model.prototype);g.id=u.time();PhiloGL.O3D=g})();(function(){var y={Vertex:{},Fragment:{}},t=y.Fragment;y.Vertex.Default="#define LIGHT_MAX 40\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec4 pickingColor;\nattribute vec2 texCoord1;\nuniform mat4 modelViewMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 normalMatrix;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nvec4 transformedNormal = normalMatrix * vec4(normal, 1.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nvColor = color;\nvPickingColor = pickingColor;\nvTexCoord = texCoord1;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";
t.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif(!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif(enablePicking) {\nif(hasPickingColors) {\ngl_FragColor = vPickingColor;\n} else {\ngl_FragColor = vec4(pickColor, 1.0);\n}\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
PhiloGL.Shaders=y})();(function(){var y=PhiloGL.Vec3,t=PhiloGL.Mat4,m=function(k,f,h){h=u.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},h||{});this.program=h.program?k[h.program]:k;this.camera=f;this.models=[];this.config=h};m.prototype={add:function(){for(var k=0,f=this.models,h=arguments.length;k<h;k++){var g=arguments[k];g.id=g.id||u.uid();f.push(g);this.defineBuffers(g)}},remove:function(k){var f=this.models;
k=f.indexOf(k);k>-1&&f.splice(k,1)},getProgram:function(k){var f=this.program;if(f.$$family!="program"&&k&&k.program){f=f[k.program];f.use()}return f},defineBuffers:function(k){var f=this.getProgram(k);k.setAttributes(f,true);k.setVertices(f,true);k.setColors(f,true);k.setPickingColors(f,true);k.setNormals(f,true);k.setTexCoords(f,true);k.setIndices(f,true)},beforeRender:function(k){this.setupLighting(k);this.setupEffects(k);var f=this.camera;k.setUniform("projectionMatrix",f.projection);k.setUniform("viewMatrix",
f.modelView)},setupLighting:function(k){var f=this.config.lights,h=f.ambient,g=f.directional,c=g.color,j=g.direction,l=f.enable;f=f.points&&u.splat(f.points)||[];g=f.length;var o=[],q=[],a=[],b=[];j=y.unit(j).$scale(-1);k.setUniform("enableLights",l);if(l){k.setUniform("ambientColor",[h.r,h.g,h.b]);k.setUniform("directionalColor",[c.r,c.g,c.b]);k.setUniform("lightingDirection",[j.x,j.y,j.z]);k.setUniform("numberPoints",g);for(h=0;h<g;h++){l=f[h];c=l.position;j=l.color||l.diffuse;l=l.specular;o.push(c.x,
c.y,c.z);q.push(j.r,j.g,j.b);a.push(+!!l);l?b.push(l.r,l.g,l.b):b.push(0,0,0)}k.setUniforms({pointLocation:o,pointColor:q});k.setUniforms({enableSpecular:a,pointSpecularColor:b})}},setupEffects:function(k){var f=this.config.effects.fog,h=f.color||{r:0.5,g:0.5,b:0.5};f?k.setUniforms({hasFog:true,fogNear:f.near,fogFar:f.far,fogColor:[h.r,h.g,h.b]}):k.setUniform("hasFog",false)},render:function(k){k=k||{};var f=this.camera,h=this.program,g=k.renderProgram,c=u.type(h),j=!g&&c=="object",l=u.merge({onBeforeRender:u.empty,
onAfterRender:u.empty},k||{});!j&&this.beforeRender(g||h);this.models.forEach(function(o,q){if(o.display){var a=g||this.getProgram(o);j&&this.beforeRender(a);o.onBeforeRender(a,f);l.onBeforeRender(o,q);this.renderObject(o,a);l.onAfterRender(o,q);o.onAfterRender(a,f)}},this)},renderToTexture:function(k,f){f=f||{};var h=X.textures[k+"-texture"],g=X.textureMemo[k+"-texture"];this.render(f);p.bindTexture(g.textureType,h);p.generateMipmap(g.textureType);p.bindTexture(g.textureType,null)},renderObject:function(k,
f){var h=this.camera,g=new t;k.setUniforms(f);k.setAttributes(f);k.setShininess(f);k.setVertices(f);k.setColors(f);k.setPickingColors(f);k.setNormals(f);k.setTextures(f);k.setTexCoords(f);k.setIndices(f);g.mulMat42(h.modelView,k.matrix);f.setUniform("modelViewMatrix",g);f.setUniform("normalMatrix",g.invert().$transpose());if(k.render)k.render(p,f,h);else k.indices?p.drawElements(k.drawType!==undefined?p.get(k.drawType):p.TRIANGLES,k.indices.length,p.UNSIGNED_SHORT,0):p.drawArrays(p.get(k.drawType||
"TRIANGLES"),0,k.vertices.length/3);k.unsetAttributes(f);k.unsetVertices(f);k.unsetColors(f);k.unsetPickingColors(f);k.unsetNormals(f);k.unsetTexCoords(f);k.unsetIndices(f)},setupPicking:function(){var k=PhiloGL.Program.fromDefaultShaders();X.setFrameBuffer("$picking",{width:1,height:1,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:true});X.setFrameBuffer("$picking",false);this.pickingProgram=
k},pick:function(k,f){this.pickingProgram||this.setupPicking();var h={},g=[],c=X.usedProgram,j=this.pickingProgram,l=this.config,o=l.lights.enable,q=l.effects.fog,a=p.canvas.width,b=p.canvas.height,d=[],i=new Uint8Array(4),n=0,s;l.lights.enable=false;l.effects.fog=false;j.use();X.setFrameBuffer("$picking",true);j.setUniform("enablePicking",true);p.disable(p.BLEND);p.viewport(-k,f-b,a,b);p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT);p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,i);s=i[0]+i[1]*256+i[2]*
65536;this.renderToTexture("$picking",{renderProgram:j,onBeforeRender:function(w,x){if(x==s)n=1;var z=x+n,D=!!w.pickingColors;j.setUniform("hasPickingColors",D);if(D)g.push(w);else{d[0]=z%256;d[1]=(z/256>>0)%256;d[2]=(z/65536>>0)%256;j.setUniform("pickColor",[d[0]/255,d[1]/255,d[2]/255]);h[d.join()]=w}}});p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,i);a=[i[0],i[1],i[2]].join();a=h[a];if(!a)for(var r=0,v=g.length;r<v;r++){a=g[r];b=a.pick(i);if(b!==false)a.$pickingIndex=b;else a=false}X.setFrameBuffer("$picking",
false);j.setUniform("enablePicking",false);l.lights.enable=o;l.effects.fog=q;c&&c.use();return a&&a.pickable&&a}};m.MAX_TEXTURES=3;m.MAX_POINT_LIGHTS=50;PhiloGL.Scene=m})();(function(){function y(t,m){for(var k=this.workers=[];m--;)k.push(new Worker(t))}y.prototype={map:function(t){var m=this.workers,k=this.configs=[],f=0;for(m=m.length;f<m;f++)k.push(t&&t(f));return this},reduce:function(t){for(var m=t.reduceFn,k=this.workers,f=this.configs,h=k.length,g=t.initialValue,c=function(q){h--;g=g===undefined?
q.data:m(g,q.data);if(h==0)t.onComplete(g)},j=0,l=h;j<l;j++){var o=k[j];o.onmessage=c;o.postMessage(f[j])}return this}};PhiloGL.WorkerGroup=y})();(function(){var y=function(f){this.opt=u.merge({duration:1E3,transition:function(h){return h},onCompute:u.empty,onComplete:u.empty},f||{})};y.prototype={timer:null,time:null,start:function(f){this.opt=u.merge(this.opt,f||{});this.time=u.time();this.animating=true},step:function(){if(this.animating){var f=u.time(),h=this.time,g=this.opt;if(f<h+g.duration){f=
g.transition((f-h)/g.duration);g.onCompute.call(this,f)}else{this.animating=false;g.onCompute.call(this,1);g.onComplete.call(this)}}}};y.compute=function(f,h,g){return f+(h-f)*g};y.Transition={linear:function(f){return f}};var t=y.Transition;(function(){var f=function(c,j){j=u.splat(j);return u.extend(c,{easeIn:function(l){return c(l,j)},easeOut:function(l){return 1-c(1-l,j)},easeInOut:function(l){return l<=0.5?c(2*l,j)/2:(2-c(2*(1-l),j))/2}})},h={Pow:function(c,j){return Math.pow(c,j[0]||6)},Expo:function(c){return Math.pow(2,
8*(c-1))},Circ:function(c){return 1-Math.sin(Math.acos(c))},Sine:function(c){return 1-Math.sin((1-c)*Math.PI/2)},Back:function(c,j){j=j[0]||1.618;return Math.pow(c,2)*((j+1)*c-j)},Bounce:function(c){for(var j,l=0,o=1;;l+=o,o/=2)if(c>=(7-4*l)/11){j=o*o-Math.pow((11-6*l-11*c)/4,2);break}return j},Elastic:function(c,j){return Math.pow(2,10*--c)*Math.cos(20*c*Math.PI*(j[0]||1)/3)}},g;for(g in h)t[g]=f(h[g]);["Quad","Cubic","Quart","Quint"].forEach(function(c,j){t[c]=f(function(l){return Math.pow(l,[j+
2])})})})();var m=self||window;if(m){var k=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(f){if(f in m){y.animationTime=function(){return m[f]};k=true}});if(!k)y.animationTime=u.time;k=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(f){if(f in m){y.requestAnimationFrame=function(h){m[f](function(){h()})};k=true}});if(!k)y.requestAnimationFrame=
function(f){setTimeout(function(){f()},1E3/60)}}PhiloGL.Fx=y})()})();
