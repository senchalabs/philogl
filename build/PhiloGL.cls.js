(function(){function v(y){return document.getElementById(y)}var G;G=null;(function(){G=function(y,x){function m(r,w,s){var A=r.canvas,a=new G.Camera(k.fov,k.aspect||A.width/A.height,k.near,k.far,k);a.update();var b=new G.Scene(w,a,c);N=new G.WebGL.Application({gl:r,canvas:A,program:w,scene:b,camera:a});w.$$family=="program"&&w.use();e&&G.Events.create(N,v.extend(e,{bind:N}));if(d.src.length)new G.IO.Textures(v.extend(d,{onComplete:function(){s(N)}}));else s(N)}x=v.merge({context:{},camera:{fov:45,
near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:v.empty,onError:v.empty},x||{});var n=x.context,k=x.camera,e=x.events,d=x.textures,f=v.splat(x.program),c=x.scene;p=G.WebGL.getContext(y,n);if(!p){x.onError("The WebGL context couldn't been initialized");return null}var g={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},h=f.length,j=function(){var r=h,w={},s=false;return{onSuccess:function(A,
a){w[a.id||h-r]=A;r--;if(r===0&&!s)m(p,h==1?A:w,function(b){x.onLoad(b)})},onError:function(A){r--;x.onError(A);s=true}}}();f.forEach(function(r){var w=r.from,s,A;for(A in g)if(w==A){try{s=G.Program[g[A]](v.extend(j,r))}catch(a){j.onError(a)}break}if(s)j.onSuccess(s,r)})}})();G.unpack=function(y){y=y||ba;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx","Media"].forEach(function(x){y[x]=G[x]});y.gl=p;y.Utils=v};G.version="1.5.2";var p,N,ba=this;
v.empty=function(){};v.time=Date.now;v.uid=function(){var y=v.time();return function(){return y++}}();v.extend=function(y,x){for(var m in x)y[m]=x[m];return y};v.type=function(){var y=Object.prototype.toString;return function(x){var m;m=y.call(x);m=m.substr(8,m.length-9).toLowerCase();if(m!="object")return m;if(x.$$family)return x.$$family;return x&&x.nodeName&&x.nodeType==1?"element":m}}();(function(){function y(x){var m=v.type(x);if(m=="object"){m={};for(var n in x)m[n]=y(x[n]);return m}else if(m==
"array"){m=[];n=0;for(var k=x.length;n<k;n++)m[n]=y(x[n]);return m}else return x}v.merge=function(){for(var x={},m=0,n=arguments.length;m<n;m++){var k=arguments[m];if(v.type(k)=="object")for(var e in k){var d=k[e],f=x[e];x[e]=f&&v.type(d)=="object"&&v.type(f)=="object"?v.merge(f,d):y(d)}}return x}})();v.splat=function(){var y=Array.isArray;return function(x){return y(x)&&x||[x]}}();(function(){function y(m){for(var n in m)this[n]=m[n];this.buffers={};this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo=
{};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var x={getContext:function(m,n){m=typeof m=="string"?v(m):m;var k;(k=m.getContext("experimental-webgl",n))||(k=m.getContext("webgl",n));if(k&&n&&n.debug){p={};for(var e in k){var d=k[e];p[e]=typeof d=="function"?function(f,c){return function(){console.log(f,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var g=c.apply(k,arguments)}catch(h){throw f+" "+h;}for(var j=[],r;(r=k.getError())!==
k.NO_ERROR;)j.push(r);if(j.length)throw j.join();return g}}(e,d):d}}else p=k;if(p)p.get=function(f){return typeof f=="string"?p[f]:f};return p}};y.prototype={$$family:"application",setBuffer:function(m,n,k){if(k===false||k===null){(k=this.bufferMemo[n])&&p.bindBuffer(k.bufferType,null);var e=k&&k.attribute||n;m=m.attributes[e];m!==undefined&&p.disableVertexAttribArray(m)}else{k=v.extend(this.bufferMemo[n]||{bufferType:p.ARRAY_BUFFER,size:1,dataType:p.FLOAT,stride:0,offset:0,drawType:p.STATIC_DRAW,
instanced:0},k||{});e=k.attribute||n;var d=k.bufferType,f=k.instanced,c=n in this.buffers,g=c?this.buffers[n]:p.createBuffer(),h="value"in k,j=k.value,r=k.size,w=k.dataType,s=k.stride,A=k.offset,a=k.drawType;m=m.attributes[e];var b=m!==undefined;c||(this.buffers[n]=g);b&&p.enableVertexAttribArray(m);p.bindBuffer(d,g);h&&p.bufferData(d,j,a);if(b){p.vertexAttribPointer(m,r,w,false,s,A);if(f)(d=p.getExtension("ANGLE_instanced_arrays"))?d.vertexAttribDivisorANGLE(m,f===true?1:f):console.warn("ANGLE_instanced_arrays not supported!")}delete k.value;
this.bufferMemo[n]=k;if(b)this.bufferMemo[e]=k;return this}},setBuffers:function(m,n){for(var k in n)this.setBuffer(m,k,n[k]);return this},setFrameBuffer:function(m,n){if(typeof n!="object")p.bindFramebuffer(p.FRAMEBUFFER,n?this.frameBuffers[m]:null);else{n=v.merge(this.frameBufferMemo[m]||{width:0,height:0,bindToTexture:false,textureOptions:{attachment:p.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:p.DEPTH_ATTACHMENT}},n||{});var k=n.bindToTexture,e=n.bindToRenderBuffer,
d=m in this.frameBuffers,f=d?this.frameBuffers[m]:p.createFramebuffer();p.bindFramebuffer(p.FRAMEBUFFER,f);d||(this.frameBuffers[m]=f);if(k){k=v.merge({data:{width:n.width,height:n.height}},v.type(k)=="object"?k:{});d=m+"-texture";f=n.textureOptions;this.setTexture(d,k);p.framebufferTexture2D(p.FRAMEBUFFER,f.attachment,this.textureMemo[d].textureType,this.textures[d],0)}if(e){e=v.extend({width:n.width,height:n.height},v.type(e)=="object"?e:{});k=m+"-renderbuffer";d=n.renderBufferOptions;this.setRenderBuffer(k,
e);p.framebufferRenderbuffer(p.FRAMEBUFFER,d.attachment,p.RENDERBUFFER,this.renderBuffers[k])}p.bindTexture(p.TEXTURE_2D,null);p.bindRenderbuffer(p.RENDERBUFFER,null);p.bindFramebuffer(p.FRAMEBUFFER,null);this.frameBufferMemo[m]=n;return this}},setFrameBuffers:function(m){for(var n in m)this.setFrameBuffer(n,m[n]);return this},setRenderBuffer:function(m,n){if(typeof n!="object")p.bindRenderbuffer(p.RENDERBUFFER,n?this.renderBufferMemo[m]:null);else{n=v.extend(this.renderBufferMemo[m]||{storageType:p.DEPTH_COMPONENT16,
width:0,height:0},n||{});var k=m in this.renderBuffers,e=k?this.renderBuffers[m]:p.createRenderbuffer(p.RENDERBUFFER);k||(this.renderBuffers[m]=e);p.bindRenderbuffer(p.RENDERBUFFER,e);p.renderbufferStorage(p.RENDERBUFFER,n.storageType,n.width,n.height);this.renderBufferMemo[m]=n;return this}},setRenderBuffers:function(m){for(var n in m)this.setRenderBuffer(n,m[n]);return this},setTexture:function(m,n){if(!n||typeof n!="object"){p.activeTexture(n||p.TEXTURE0);p.bindTexture(this.textureMemo[m].textureType||
p.TEXTURE_2D,this.textures[m])}else{if(n.data&&n.data.type===p.FLOAT)if(!p.getExtension("OES_texture_float"))throw"OES_texture_float is not supported";n=v.merge(this.textureMemo[m]||{textureType:p.TEXTURE_2D,pixelStore:[{name:p.UNPACK_FLIP_Y_WEBGL,value:true},{name:p.UNPACK_ALIGNMENT,value:1}],parameters:[{name:p.TEXTURE_MAG_FILTER,value:p.NEAREST},{name:p.TEXTURE_MIN_FILTER,value:p.NEAREST},{name:p.TEXTURE_WRAP_S,value:p.CLAMP_TO_EDGE},{name:p.TEXTURE_WRAP_T,value:p.CLAMP_TO_EDGE}],data:{format:p.RGBA,
value:false,type:p.UNSIGNED_BYTE,width:0,height:0,border:0}},n||{});var k="textureType"in n?n.textureType=p.get(n.textureType):p.TEXTURE_2D,e="textureTarget"in n?n.textureTarget=p.get(n.textureTarget):k,d=k==p.TEXTURE_CUBE_MAP,f=m in this.textures,c=f?this.textures[m]:p.createTexture(),g=n.pixelStore,h=n.parameters,j=n.data,r=j.value,w=j.type,s=j.format,A=!!j.value;f||(this.textures[m]=c);p.bindTexture(k,c);f||g.forEach(function(a){a.name=typeof a.name=="string"?p.get(a.name):a.name;p.pixelStorei(a.name,
a.value)});if(A)if(d)for(c=0;c<6;++c)(j.width||j.height)&&!r.width&&!r.height?p.texImage2D(e[c],0,s,j.width,j.height,j.border,s,w,r[c]):p.texImage2D(e[c],0,s,s,w,r[c]);else(j.width||j.height)&&!r.width&&!r.height?p.texImage2D(e,0,s,j.width,j.height,j.border,s,w,r):p.texImage2D(e,0,s,s,w,r);else if(j.width||j.height)p.texImage2D(e,0,s,j.width,j.height,j.border,s,w,null);if(!f)for(c=0;c<h.length;c++){e=h[c];e.name=p.get(e.name);e.value=p.get(e.value);p.texParameteri(k,e.name,e.value);e.generateMipmap&&
p.generateMipmap(k)}n.isCube=d;if(A)n.data.value=false;this.textureMemo[m]=n;return this}},setTextures:function(m){for(var n in m)this.setTexture(n,m[n]);return this},use:function(m){p.useProgram(m.program);this.usedProgram=m;return this}};x.Application=y;(function(){try{var m=document.createElement("canvas");G.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(m.getContext("webgl")||m.getContext("experimental-webgl")))}}catch(n){G.hasWebGL=function(){return false}}G.hasExtension=function(k){if(!G.hasWebGL())return false;
var e=document.createElement("canvas");return(e.getContext("webgl")||e.getContext("experimental-webgl")).getExtension(k)}})();G.WebGL=x})();(function(){function y(a){return{get:function(){return this[a]},set:function(b){this[a]=b},configurable:false,enumerable:false}}var x=Math.sqrt,m=Math.sin,n=Math.cos,k=Math.tan,e=Math.PI,d=Array.prototype.slice,f=this.Float32Array,c=function(){if(!f||!f.call)return Array;try{f.call({},10)}catch(a){return Array}return f}(),g=c!=Array,h=function(a,b,i){if(g){f.call(this,
3);this[0]=a||0;this[1]=b||0;this[2]=i||0}else this.push(a||0,b||0,i||0);this.typedContainer=new f(3)};h.create=function(){return new f(3)};h.prototype=Object.create(c.prototype,{$$family:{value:"Vec3"},x:y(0),y:y(1),z:y(2)});var j={setVec3:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,i,o){a[0]=b;a[1]=i;a[2]=o;return a},add:function(a,b){return new h(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,i){a[0]=b[0]+
i[0];a[1]=b[1]+i[1];a[2]=b[2]+i[2];return a},sub:function(a,b){return new h(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,i){a[0]=b[0]-i[0];a[1]=b[1]-i[1];a[2]=b[2]-i[2];return a},scale:function(a,b){return new h(a[0]*b,a[1]*b,a[2]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new h(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=h.norm(a);if(b>
0)return h.scale(a,1/b);return h.clone(a)},$unit:function(a){var b=h.norm(a);if(b>0)return h.$scale(a,1/b);return a},cross:function(a,b){var i=a[0],o=a[1],q=a[2],t=b[0],u=b[1],z=b[2];return new h(o*z-q*u,q*t-i*z,i*u-o*t)},$cross:function(a,b){var i=a[0],o=a[1],q=a[2],t=b[0],u=b[1],z=b[2];a[0]=o*z-q*u;a[1]=q*t-i*z;a[2]=i*u-o*t;return a},distTo:function(a,b){var i=a[0]-b[0],o=a[1]-b[1],q=a[2]-b[2];return x(i*i+o*o+q*q)},distToSq:function(a,b){var i=a[0]-b[0],o=a[1]-b[1],q=a[2]-b[2];return i*i+o*o+q*
q},norm:function(a){var b=a[0],i=a[1];a=a[2];return x(b*b+i*i+a*a)},normSq:function(a){var b=a[0],i=a[1];a=a[2];return b*b+i*i+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return a.$$family?new h(a[0],a[1],a[2]):h.setVec3(new f(3),a)},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}},r=h.prototype,w;for(w in j){h[w]=j[w];r[w]=function(a){return function(){var b=d.call(arguments);b.unshift(this);return h[a].apply(h,
b)}}(w)}var s=function(a,b,i,o,q,t,u,z,B,C,D,E,H,I,L,J){c.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,i,o,q,t,u,z,B,C,D,E,H,I,L,J):this.id();this.typedContainer=new f(16)};s.create=function(){return new f(16)};s.prototype=Object.create(c.prototype,{$$family:{value:"Mat4"},n11:y(0),n12:y(4),n13:y(8),n14:y(12),n21:y(1),n22:y(5),n23:y(9),n24:y(13),n31:y(2),n32:y(6),n33:y(10),n34:y(14),n41:y(3),n42:y(7),n43:y(11),n44:y(15)});j={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;
a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return a.$$family?new s(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):new f(a)},set:function(a,b,i,o,q,t,u,z,B,C,D,E,H,I,L,J,F){a[0]=b;a[4]=i;a[8]=o;a[12]=q;a[1]=t;a[5]=u;a[9]=z;a[13]=B;a[2]=C;a[6]=D;a[10]=E;a[14]=H;a[3]=I;a[7]=L;a[11]=J;a[15]=F;return a},mulVec3:function(a,b){var i=h.clone(b);return s.$mulVec3(a,i)},$mulVec3:function(a,b){var i=b[0],o=b[1],
q=b[2],t=1/(a[3]*i+a[7]*o+a[11]*q+a[15]);b[0]=(a[0]*i+a[4]*o+a[8]*q+a[12])*t;b[1]=(a[1]*i+a[5]*o+a[9]*q+a[13])*t;b[2]=(a[2]*i+a[6]*o+a[10]*q+a[14])*t;return b},mulMat42:function(a,b,i){var o=b[0],q=b[1],t=b[2],u=b[3],z=b[4],B=b[5],C=b[6],D=b[7],E=b[8],H=b[9],I=b[10],L=b[11],J=b[12],F=b[13],O=b[14];b=b[15];var K=i[0],M=i[1],Q=i[2],R=i[3],T=i[4],S=i[5],X=i[6],U=i[7],V=i[8],Y=i[9],W=i[10],P=i[11],Z=i[12],$=i[13],aa=i[14];i=i[15];a[0]=K*o+M*z+Q*E+R*J;a[1]=K*q+M*B+Q*H+R*F;a[2]=K*t+M*C+Q*I+R*O;a[3]=K*u+
M*D+Q*L+R*b;a[4]=T*o+S*z+X*E+U*J;a[5]=T*q+S*B+X*H+U*F;a[6]=T*t+S*C+X*I+U*O;a[7]=T*u+S*D+X*L+U*b;a[8]=V*o+Y*z+W*E+P*J;a[9]=V*q+Y*B+W*H+P*F;a[10]=V*t+Y*C+W*I+P*O;a[11]=V*u+Y*D+W*L+P*b;a[12]=Z*o+$*z+aa*E+i*J;a[13]=Z*q+$*B+aa*H+i*F;a[14]=Z*t+$*C+aa*I+i*O;a[15]=Z*u+$*D+aa*L+i*b;return a},mulMat4:function(a,b){var i=s.clone(a);return s.mulMat42(i,a,b)},$mulMat4:function(a,b){return s.mulMat42(a,a,b)},add:function(a,b){var i=s.clone(a);return s.$add(i,b)},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];
a[3]+=b[3];a[4]+=b[4];a[5]+=b[5];a[6]+=b[6];a[7]+=b[7];a[8]+=b[8];a[9]+=b[9];a[10]+=b[10];a[11]+=b[11];a[12]+=b[12];a[13]+=b[13];a[14]+=b[14];a[15]+=b[15];return a},transpose:function(a){a=s.clone(a);return s.$transpose(a)},$transpose:function(a){var b=a[8],i=a[12],o=a[1],q=a[9],t=a[13],u=a[2],z=a[6],B=a[14],C=a[3],D=a[7],E=a[11];a[1]=a[4];a[2]=b;a[3]=i;a[4]=o;a[6]=q;a[7]=t;a[8]=u;a[9]=z;a[11]=B;a[12]=C;a[13]=D;a[14]=E;return a},rotateAxis:function(a,b,i){a=s.clone(a);return s.$rotateAxis(a,b,i)},
$rotateAxis:function(a,b,i){var o=m(b),q=n(b),t=1-q,u=i[0],z=i[1],B=i[2];i=u*u*t+q;b=u*z*t+B*o;var C=u*B*t-z*o,D=z*u*t-B*o,E=z*z*t+q,H=z*B*t+u*o,I=u*B*t+z*o;o=z*B*t-u*o;q=B*B*t+q;t=a[0];u=a[1];z=a[2];B=a[3];var L=a[4],J=a[5],F=a[6],O=a[7],K=a[8],M=a[9],Q=a[10],R=a[11];a[0]=t*i+L*b+K*C;a[1]=u*i+J*b+M*C;a[2]=z*i+F*b+Q*C;a[3]=B*i+O*b+R*C;a[4]=t*D+L*E+K*H;a[5]=u*D+J*E+M*H;a[6]=z*D+F*E+Q*H;a[7]=B*D+O*E+R*H;a[8]=t*I+L*o+K*q;a[9]=u*I+J*o+M*q;a[10]=z*I+F*o+Q*q;a[11]=B*I+O*o+R*q;return a},rotateXYZ:function(a,
b,i,o){a=s.clone(a);return s.$rotateXYZ(a,b,i,o)},$rotateXYZ:function(a,b,i,o){var q=a[0],t=a[1],u=a[2],z=a[3],B=a[4],C=a[5],D=a[6],E=a[7],H=a[8],I=a[9],L=a[10],J=a[11],F=n(b),O=n(i),K=n(o);b=m(b);var M=m(i),Q=m(o);o=O*K;i=-F*Q+b*M*K;var R=b*Q+F*M*K,T=O*Q,S=F*K+b*M*Q;K=-b*K+F*M*Q;M=-M;b*=O;F*=O;a[0]=q*o+B*T+H*M;a[1]=t*o+C*T+I*M;a[2]=u*o+D*T+L*M;a[3]=z*o+E*T+J*M;a[4]=q*i+B*S+H*b;a[5]=t*i+C*S+I*b;a[6]=u*i+D*S+L*b;a[7]=z*i+E*S+J*b;a[8]=q*R+B*K+H*F;a[9]=t*R+C*K+I*F;a[10]=u*R+D*K+L*F;a[11]=z*R+E*K+J*F;
return a},translate:function(a,b,i,o){a=s.clone(a);return s.$translate(a,b,i,o)},$translate:function(a,b,i,o){a[12]=a[0]*b+a[4]*i+a[8]*o+a[12];a[13]=a[1]*b+a[5]*i+a[9]*o+a[13];a[14]=a[2]*b+a[6]*i+a[10]*o+a[14];a[15]=a[3]*b+a[7]*i+a[11]*o+a[15];return a},scale:function(a,b,i,o){a=s.clone(a);return s.$scale(a,b,i,o)},$scale:function(a,b,i,o){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;a[4]*=i;a[5]*=i;a[6]*=i;a[7]*=i;a[8]*=o;a[9]*=o;a[10]*=o;a[11]*=o;return a},invert:function(a){a=s.clone(a);return s.$invert(a)},
$invert:function(a){var b=a[0],i=a[1],o=a[2],q=a[3],t=a[4],u=a[5],z=a[6],B=a[7],C=a[8],D=a[9],E=a[10],H=a[11],I=a[12],L=a[13],J=a[14],F=a[15],O=b*u-i*t,K=b*z-o*t,M=b*B-q*t,Q=i*z-o*u,R=i*B-q*u,T=o*B-q*z,S=C*L-D*I,X=C*J-E*I,U=C*F-H*I,V=D*J-E*L,Y=D*F-H*L,W=E*F-H*J,P=1/(O*W-K*Y+M*V+Q*U-R*X+T*S);a[0]=(+u*W-z*Y+B*V)*P;a[1]=(-i*W+o*Y-q*V)*P;a[2]=(+L*T-J*R+F*Q)*P;a[3]=(-D*T+E*R-H*Q)*P;a[4]=(-t*W+z*U-B*X)*P;a[5]=(+b*W-o*U+q*X)*P;a[6]=(-I*T+J*M-F*K)*P;a[7]=(+C*T-E*M+H*K)*P;a[8]=(+t*Y-u*U+B*S)*P;a[9]=(-b*Y+
i*U-q*S)*P;a[10]=(+I*R-L*M+F*O)*P;a[11]=(-C*R+D*M-H*O)*P;a[12]=(-t*V+u*X-z*S)*P;a[13]=(+b*V-i*X+o*S)*P;a[14]=(-I*Q+L*K-J*O)*P;a[15]=(+C*Q-D*K+E*O)*P;return a},lookAt:function(a,b,i,o){i=h.sub(b,i);i.$unit();o=h.cross(o,i);o.$unit();var q=h.cross(i,o);q.$unit();return s.set(a,o[0],o[1],o[2],-o.dot(b),q[0],q[1],q[2],-q.dot(b),i[0],i[1],i[2],-i.dot(b),0,0,0,1)},frustum:function(a,b,i,o,q,t,u){var z=i-b,B=q-o,C=u-t;a[0]=t*2/z;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=t*2/B;a[6]=0;a[7]=0;a[8]=(i+b)/z;a[9]=(q+o)/
B;a[10]=-(u+t)/C;a[11]=-1;a[12]=0;a[13]=0;a[14]=-(u*t*2)/C;a[15]=0;return a},perspective:function(a,b,i,o,q){b=o*k(b*e/360);var t=-b;return s.frustum(a,t*i,b*i,t,b,o,q)},ortho:function(a,b,i,o,q,t,u){var z=i-b,B=o-q,C=u-t;a[0]=2/z;a[4]=0;a[8]=0;a[12]=-((i+b)/z);a[1]=0;a[5]=2/B;a[9]=0;a[13]=-((o+q)/B);a[2]=0;a[6]=0;a[10]=-2/C;a[14]=-((u+t)/C);a[3]=0;a[7]=0;a[11]=0;a[15]=1;return a},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=
a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}};r=s.prototype;for(w in j){s[w]=j[w];r[w]=function(a){return function(){var b=d.call(arguments);b.unshift(this);return s[a].apply(s,b)}}(w)}var A=function(a,b,i,o){c.call(this,4);this[0]=a||0;this[1]=b||0;this[2]=i||0;this[3]=o||0;this.typedContainer=new f(4)};A.create=function(){return new f(4)};j={setQuat:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,
b,i,o,q){a[0]=b||0;a[1]=i||0;a[2]=o||0;a[3]=q||0;return a},clone:function(a){return a.$$family?new A(a[0],a[1],a[2],a[3]):A.setQuat(new f(4),a)},neg:function(a){return new A(-a[0],-a[1],-a[2],-a[3])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];a[3]=-a[3];return a},add:function(a,b){return new A(a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];return a},sub:function(a,b){return new A(a[0]-b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3])},$sub:function(a,
b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];a[3]-=b[3];return a},scale:function(a,b){return new A(a[0]*b,a[1]*b,a[2]*b,a[3]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;return a},mulQuat:function(a,b){var i=a[0],o=a[1],q=a[2],t=a[3],u=b[0],z=b[1],B=b[2],C=b[3];return new A(t*u+i*C+o*B-q*z,t*z+o*C+q*u-i*B,t*B+q*C+i*z-o*u,t*C-i*u-o*z-q*B)},$mulQuat:function(a,b){var i=a[0],o=a[1],q=a[2],t=a[3],u=b[0],z=b[1],B=b[2],C=b[3];a[0]=t*u+i*C+o*B-q*z;a[1]=t*z+o*C+q*u-i*B;a[2]=t*B+q*C+i*z-o*u;a[3]=t*C-i*
u-o*z-q*B;return a},divQuat:function(a,b){var i=a[0],o=a[1],q=a[2],t=a[3],u=b[0],z=b[1],B=b[2],C=b[3],D=1/(C*C+u*u+z*z+B*B);return new A((i*C-t*u-o*B+q*z)*D,(i*B-t*z+o*C-q*u)*D,(o*u+q*C-t*B-i*z)*D,(t*C+i*u+o*z+q*B)*D)},$divQuat:function(a,b){var i=a[0],o=a[1],q=a[2],t=a[3],u=b[0],z=b[1],B=b[2],C=b[3],D=1/(C*C+u*u+z*z+B*B);a[0]=(i*C-t*u-o*B+q*z)*D;a[1]=(i*B-t*z+o*C-q*u)*D;a[2]=(o*u+q*C-t*B-i*z)*D;a[3]=(t*C+i*u+o*z+q*B)*D;return a},invert:function(a){var b=a[0],i=a[1],o=a[2];a=a[3];var q=1/(b*b+i*i+
o*o+a*a);return new A(-b*q,-i*q,-o*q,a*q)},$invert:function(a){var b=a[0],i=a[1],o=a[2],q=a[3],t=1/(b*b+i*i+o*o+q*q);a[0]=-b*t;a[1]=-i*t;a[2]=-o*t;a[3]=q*t;return a},norm:function(a){var b=a[0],i=a[1],o=a[2];a=a[3];return x(b*b+i*i+o*o+a*a)},normSq:function(a){var b=a[0],i=a[1],o=a[2];a=a[3];return b*b+i*i+o*o+a*a},unit:function(a){return A.scale(a,1/A.norm(a))},$unit:function(a){return A.$scale(a,1/A.norm(a))},conjugate:function(a){return new A(-a[0],-a[1],-a[2],a[3])},$conjugate:function(a){a[0]=
-a[0];a[1]=-a[1];a[2]=-a[2];return a}};r=A.prototype={};for(w in j){A[w]=j[w];r[w]=function(a){return function(){var b=d.call(arguments);b.unshift(this);return A[a].apply(A,b)}}(w)}h.fromQuat=function(a){return new h(a[0],a[1],a[2])};A.fromVec3=function(a,b){return new A(a[0],a[1],a[2],b||0)};A.fromMat4=function(a){var b,i,o;if(a[0]>a[5]&&a[0]>a[10]){b=0;i=1;o=2}else if(a[5]>a[0]&&a[5]>a[10]){b=1;i=2;o=0}else{b=2;i=0;o=1}var q=x(1+a[b*5]-a[i*5]-a[o*5]),t=new A;t[b]=0.5*q;t[i]=0.5*(a["n"+i+""+b]+a["n"+
b+""+i])/q;t[o]=0.5*(a["n"+b+""+o]+a["n"+o+""+b])/q;t[3]=0.5*(a["n"+i+""+o]-a["n"+o+""+i])/q;return t};A.fromXRotation=function(a){return new A(m(a/2),0,0,n(a/2))};A.fromYRotation=function(a){return new A(0,m(a/2),0,n(a/2))};A.fromZRotation=function(a){return new A(0,0,m(a/2),n(a/2))};A.fromAxisRotation=function(a,b){var i=a[0],o=a[1],q=a[2],t=1/x(i*i+o*o+q*q),u=m(b/2),z=n(b/2);return new A(u*i*t,u*o*t,u*q*t,z)};s.fromQuat=function(a){var b=a[3],i=a[0],o=a[1];a=a[2];return new s(b*b+i*i-o*o-a*a,2*
i*o-2*b*a,2*i*a+2*b*o,0,2*i*o+2*b*a,b*b-i*i+o*o-a*a,2*o*a-2*b*i,0,2*i*a-2*b*o,2*o*a+2*b*i,b*b-i*i-o*o+a*a,0,0,0,0,1)};G.Vec3=h;G.Mat4=s;G.Quat=A})();(function(){function y(e){return e!==true?e:false}var x=function(e){e=e.getBoundingClientRect();return{x:e.left,y:e.top,bbox:e}},m={get:function(e,d){return e||(d||window).event},getWheel:function(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3},getKey:function(e){var d=e.which||e.keyCode,f;a:{f=k.Keys;for(var c in f)if(f[c]==d){f=c;break a}f=
void 0}c=d-111;if(c>0&&c<13)f="f"+c;f=f||String.fromCharCode(d).toLowerCase();return{code:d,key:f,shift:e.shiftKey,control:e.ctrlKey,alt:e.altKey,meta:e.metaKey}},isRightClick:function(e){return e.which==3||e.button==2},getPos:function(e,d){d=d||window;e=e||d.event;var f=d.document,c;f=f.documentElement||f.body;if(e.touches&&e.touches.length){c=[];for(var g=0,h=e.touches.length,j;g<h;++g){j=e.touches[g];c.push({x:j.pageX||j.clientX+f.scrollLeft,y:j.pageY||j.clientY+f.scrollTop})}return c}return[{x:e.pageX||
e.clientX+f.scrollLeft,y:e.pageY||e.clientY+f.scrollTop}]},stop:function(e){e.stopPropagation&&e.stopPropagation();e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false}},n=function(e,d){var f=e.canvas;this.scene=e.scene;this.domElem=f;this.pos=x(f);this.opt=this.callbacks=d;this.size={width:f.width||f.offsetWidth,height:f.height||f.offsetHeight};this.attachEvents()};n.prototype={hovered:false,pressed:false,touched:false,touchedLastPosition:{x:0,y:0},touchMoved:false,
moved:false,attachEvents:function(){var e=this.domElem,d=this.opt,f=this;if(d.disableContextMenu)e.oncontextmenu=function(){return false};if(d.enableMouse){["mouseup","mousedown","mousemove","mouseover","mouseout"].forEach(function(g){e.addEventListener(g,function(h,j){f[g](f.eventInfo(g,h,j))},false)});var c="";c=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";e.addEventListener(c,function(g,h){f.mousewheel(f.eventInfo("mousewheel",g,h))},false)}d.enableTouch&&
["touchstart","touchmove","touchend"].forEach(function(g){e.addEventListener(g,function(h,j){f[g](f.eventInfo(g,h,j))},false)});d.enableKeyboard&&["keydown","keyup"].forEach(function(g){document.addEventListener(g,function(h,j){f[g](f.eventInfo(g,h,j))},false)})},eventInfo:function(e,d,f){var c=this.domElem,g=this.scene,h=this.opt,j=this.getSize(),r=h.relative,w=h.centerOrigin,s=h.cachePosition&&this.pos||x(c),A=m.get(d,f);d=m.getPos(d,f);var a={x:d[0].x,y:d[0].y};f={};for(var b,i=0,o=d.length;i<
o;++i){c=d[i].x;b=d[i].y;if(r){c-=s.x;b-=s.y;if(w){c-=j.width/2;b-=j.height/2;b*=-1}}d[i].x=c;d[i].y=b}switch(e){case "mousewheel":f.wheel=m.getWheel(A);break;case "keydown":case "keyup":v.extend(f,m.getKey(A));break;case "mouseup":f.isRightClick=m.isRightClick(A)}var q;v.extend(f,{x:d[0].x,y:d[0].y,posArray:d,cache:false,stop:function(){m.stop(A)},getTarget:function(){if(q)return q;return q=h.picking&&g.pick(a.x-s.x,a.y-s.y)||true}});f.event=A;return f},getSize:function(){if(this.cacheSize)return this.size;
var e=this.domElem;return{width:e.width||e.offsetWidth,height:e.height||e.offsetHeight}},mouseup:function(e){if(!this.moved)if(e.isRightClick)this.callbacks.onRightClick(e,this.hovered);else this.callbacks.onClick(e,y(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(e,y(this.pressed));else this.callbacks.onDragCancel(e,y(this.pressed));this.pressed=this.moved=false}},mouseout:function(e){for(var d=e.relatedTarget,f=this.domElem;d&&d.parentNode;){if(f==d.parentNode)return;d=d.parentNode}if(this.hovered){this.callbacks.onMouseLeave(e,
this.hovered);this.hovered=false}if(this.pressed&&this.moved){this.callbacks.onDragEnd(e);this.pressed=this.moved=false}},mouseover:function(){},mousemove:function(e){if(this.pressed){this.moved=true;this.callbacks.onDragMove(e,y(this.pressed))}else{if(this.hovered){var d=y(e.getTarget());if(!d||d.hash!=this.hash){this.callbacks.onMouseLeave(e,this.hovered);if(this.hash=this.hovered=d){this.hash=d.hash;this.callbacks.onMouseEnter(e,this.hovered)}}else this.callbacks.onMouseMove(e,this.hovered)}else if(this.hash=
this.hovered=y(e.getTarget())){this.hash=this.hovered.hash;this.callbacks.onMouseEnter(e,this.hovered)}if(!this.opt.picking)this.callbacks.onMouseMove(e)}},mousewheel:function(e){this.callbacks.onMouseWheel(e)},mousedown:function(e){this.pressed=e.getTarget();this.callbacks.onDragStart(e,y(this.pressed))},touchstart:function(e){this.touched=e.getTarget();this.touchedLastPosition={x:e.x,y:e.y};this.callbacks.onTouchStart(e,y(this.touched))},touchmove:function(e){if(this.touched){this.touchMoved=true;
this.callbacks.onTouchMove(e,y(this.touched))}},touchend:function(e){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(e,y(this.touched));else{e.x=isNaN(e.x)?this.touchedLastPosition.x:e.x;e.y=isNaN(e.y)?this.touchedLastPosition.y:e.y;this.callbacks.onTap(e,y(this.touched));this.callbacks.onTouchCancel(e,y(this.touched))}this.touched=this.touchMoved=false}},keydown:function(e){this.callbacks.onKeyDown(e)},keyup:function(e){this.callbacks.onKeyUp(e)}};var k={};k.create=function(e,d){d=
v.extend({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,lazyPicking:false,enableTouch:true,enableMouse:true,enableKeyboard:true,onClick:v.empty,onRightClick:v.empty,onDragStart:v.empty,onDragMove:v.empty,onDragEnd:v.empty,onDragCancel:v.empty,onTouchStart:v.empty,onTouchMove:v.empty,onTouchEnd:v.empty,onTouchCancel:v.empty,onTap:v.empty,onMouseMove:v.empty,onMouseEnter:v.empty,onMouseLeave:v.empty,onMouseWheel:v.empty,onKeyDown:v.empty,
onKeyUp:v.empty},d||{});var f=d.bind;if(f)for(var c in d)c.match(/^on[a-zA-Z0-9]+$/)&&function(g,h){d[g]=function(){return h.apply(f,Array.prototype.slice.call(arguments))}}(c,d[c]);new n(e,d);e.events=d};k.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};G.Events=k})();(function(){function y(d,f){return v.merge(f||{},d.length==2?{vs:d[0],fs:d[1]}:d[0]||{})}var x=function(d,f,c){var g=d.createShader(c);if(g==null)throw"Error creating the shader with shader type: "+
c;d.shaderSource(g,f);d.compileShader(g);if(!d.getShaderParameter(g,d.COMPILE_STATUS)){f=d.getShaderInfoLog(g);d.deleteShader(g);throw"Error while compiling the shader "+f;}return g},m=function(d){var f=d.lastIndexOf("/");return f=="/"?"./":d.substr(0,f+1)},n=function(d,f,c,g,h){h=h||{};var j;if(j=f.match(/#include "(.*?)"/)){var r=G.IO.XHR,w=m(d)+j[1];h[w]&&g("Recursive include");(new r({url:w,noCache:true,onError:function(s){g("Load included file `"+w+"` failed: Code "+s)},onSuccess:function(s){h[w]=
true;return n(w,s,function(A){delete h[w];f=f.replace(/#include ".*?"/,A);f=f.replace(/\sHAS_EXTENSION\s*\(\s*([A-Za-z_\-0-9]+)\s*\)/g,function(a,b){return p.getExtension(b)?" 1 ":" 0 "});return n(w,f,c,g,h)},g,h)}})).send();return null}else return c(f)},k=function(d,f,c){var g=p.getUniformLocation(d,f.name);d=f.type;var h=false,j=true,r,w;if(f.size>1&&c)switch(d){case p.FLOAT:r=p.uniform1fv;w=Float32Array;j=false;break;case p.INT:case p.BOOL:case p.SAMPLER_2D:case p.SAMPLER_CUBE:r=p.uniform1iv;w=
Uint16Array;j=false}if(j)switch(d){case p.FLOAT:r=p.uniform1f;break;case p.FLOAT_VEC2:r=p.uniform2fv;w=c?Float32Array:new Float32Array(2);break;case p.FLOAT_VEC3:r=p.uniform3fv;w=c?Float32Array:new Float32Array(3);break;case p.FLOAT_VEC4:r=p.uniform4fv;w=c?Float32Array:new Float32Array(4);break;case p.INT:case p.BOOL:case p.SAMPLER_2D:case p.SAMPLER_CUBE:r=p.uniform1i;break;case p.INT_VEC2:case p.BOOL_VEC2:r=p.uniform2iv;w=c?Uint16Array:new Uint16Array(2);break;case p.INT_VEC3:case p.BOOL_VEC3:r=
p.uniform3iv;w=c?Uint16Array:new Uint16Array(3);break;case p.INT_VEC4:case p.BOOL_VEC4:r=p.uniform4iv;w=c?Uint16Array:new Uint16Array(4);break;case p.FLOAT_MAT2:h=true;r=p.uniformMatrix2fv;break;case p.FLOAT_MAT3:h=true;r=p.uniformMatrix3fv;break;case p.FLOAT_MAT4:h=true;r=p.uniformMatrix4fv}r=r.bind(p);return c&&w?function(s){r(g,new w(s))}:h?function(s){r(g,false,s.toFloat32Array())}:w?function(s){w.set(s.toFloat32Array?s.toFloat32Array():s);r(g,w)}:function(s){r(g,s)};throw"Unknown type: "+d;},
e=function(d,f){var c=p,g=c.createProgram();c.attachShader(g,x(c,d,c.VERTEX_SHADER));c.attachShader(g,x(c,f,c.FRAGMENT_SHADER));c.linkProgram(g);if(!c.getProgramParameter(g,c.LINK_STATUS))throw"Error linking the shader: "+c.getProgramInfoLog(g);if(!g)return false;c={};for(var h={},j,r,w=p.getProgramParameter(g,p.ACTIVE_ATTRIBUTES),s=0;s<w;s++){j=p.getActiveAttrib(g,s);r=j.name;j=p.getAttribLocation(g,j.name);c[r]=j}w=p.getProgramParameter(g,p.ACTIVE_UNIFORMS);for(s=0;s<w;s++){j=p.getActiveUniform(g,
s);r=j.name;r=r[r.length-1]=="]"?r.substr(0,r.length-3):r;h[r]=k(g,j,j.name!=r)}this.program=g;this.attributes=c;this.attributeEnabled={};this.uniforms=h};e.prototype={$$family:"program",setUniform:function(d,f){if(this.uniforms[d])this.uniforms[d](f);return this},setUniforms:function(d){for(var f in d)this.setUniform(f,d[f]);return this}};["setBuffer","setBuffers","use"].forEach(function(d){e.prototype[d]=function(){var f=Array.prototype.slice.call(arguments);f.unshift(this);N[d].apply(N,f);return this}});
["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture","setTextures"].forEach(function(d){e.prototype[d]=function(){N[d].apply(N,arguments);return this}});e.fromShaderIds=function(){var d=y(arguments),f=v(d.vs),c=v(d.fs);return n(d.path,f.innerHTML,function(g){return n(d.path,c.innerHTML,function(h){d.onSuccess(new e(g,h),d)})})};e.fromShaderSources=function(){var d=y(arguments,{path:"./"});return n(d.path,d.vs,function(f){return n(d.path,d.fs,function(c){try{var g=
new e(f,c);if(d.onSuccess)d.onSuccess(g,d);else return g}catch(h){if(d.onError)d.onError(h,d);else throw h;}})})};e.fromDefaultShaders=function(d){d=d||{};var f=d.fs||"Default",c=G.Shaders;d.vs=c.Vertex[d.vs||"Default"];d.fs=c.Fragment[f];return G.Program.fromShaderSources(d)};e.fromShaderURIs=function(d){d=v.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:v.empty,onError:v.empty},d||{});var f=d.path+d.vs,c=d.path+d.fs;(new G.IO.XHR.Group({urls:[f,c],noCache:d.noCache,onError:function(g){d.onError(g)},
onComplete:function(g){try{return n(f,g[0],function(j){return n(c,g[1],function(r){d.vs=j;d.fs=r;return e.fromShaderSources(d)},d.onError)},d.onError)}catch(h){d.onError(h,d)}}})).send()};G.Program=e})();(function(){var y={},x=function(k){this.opt=k=v.merge({url:"http://philogljs.org/",method:"GET",async:true,noCache:false,sendAsBinary:false,responseType:false,onProgress:v.empty,onSuccess:v.empty,onError:v.empty,onAbort:v.empty,onComplete:v.empty},k||{});this.initXHR()};x.State={};["UNINITIALIZED",
"LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(k,e){x.State[k]=e});x.prototype={initXHR:function(){var k=this.req=new XMLHttpRequest,e=this;["Progress","Error","Abort","Load"].forEach(function(d){if(k.addEventListener)k.addEventListener(d.toLowerCase(),function(f){e["handle"+d](f)},false);else k["on"+d.toLowerCase()]=function(f){e["handle"+d](f)}})},send:function(k){var e=this.req,d=this.opt,f=d.async;if(d.noCache)d.url+=(d.url.indexOf("?")>=0?"&":"?")+v.uid();e.open(d.method,d.url,
f);if(d.responseType)e.responseType=d.responseType;if(f)e.onreadystatechange=function(){if(e.readyState==x.State.COMPLETED)if(e.status==200)d.onSuccess(e.responseType?e.response:e.responseText);else d.onError(e.status)};d.sendAsBinary?e.sendAsBinary(k||d.body||null):e.send(k||d.body||null);if(!f)if(e.status==200)d.onSuccess(e.responseType?e.response:e.responseText);else d.onError(e.status)},setRequestHeader:function(k,e){this.req.setRequestHeader(k,e);return this},handleProgress:function(k){if(k.lengthComputable)this.opt.onProgress(k,
Math.round(k.loaded/k.total*100));else this.opt.onProgress(k,-1)},handleError:function(k){this.opt.onError(k)},handleAbort:function(k){this.opt.onAbort(k)},handleLoad:function(k){this.opt.onComplete(k)}};x.Group=function(k){function e(h){return function(j){--c;k.onError(j,h);if(!c)k.onComplete(g)}}function d(h){return function(j){--c;g[h]=j;k.onSuccess(j,h);if(!c)k.onComplete(g)}}k=v.merge({urls:[],onError:v.empty,onSuccess:v.empty,onComplete:v.empty,method:"GET",async:true,noCache:false,sendAsBinary:false,
responseType:false},k||{});var f=v.splat(k.urls),c=f.length,g=Array(c);this.reqs=f.map(function(h,j){return new x({url:h,method:k.method,async:k.async,noCache:k.noCache,sendAsBinary:k.sendAsBinary,responseType:k.responseType,body:k.body,onError:e(j),onSuccess:d(j)})})};x.Group.prototype={send:function(){for(var k=0,e=this.reqs,d=e.length;k<d;++k)e[k].send()}};var m=function(k){k=v.merge({url:"http://philogljs.org/",data:{},noCache:false,onComplete:v.empty,callbackKey:"callback"},k||{});var e=m.counter++,
d=[],f;for(f in k.data)d.push(f+"="+k.data[f]);d=d.join("&");if(k.noCache)d+=(d.indexOf("?")>=0?"&":"?")+v.uid();d=k.url+(k.url.indexOf("?")>-1?"&":"?")+k.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+e+(d.length>0?"&"+d:"");var c=document.createElement("script");c.type="text/javascript";c.src=d;m.requests["request_"+e]=function(g){k.onComplete(g);c.parentNode&&c.parentNode.removeChild(c);c.clearAttributes&&c.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(c)};m.counter=
0;m.requests={};var n=function(k){k=v.merge({src:[],noCache:false,onProgress:v.empty,onComplete:v.empty},k||{});var e=0,d=k.src.length,f=function(){k.onProgress(Math.round(++e/d*100));if(e==d)k.onComplete(j)},c=function(){if(++e==d)k.onComplete(j)},g=k.noCache,h=v.uid(),j=k.src.map(function(r,w){var s=new Image;s.index=w;s.onload=f;s.onerror=c;s.src=r+(g?(r.indexOf("?")>=0?"&":"?")+h:"");return s});return j};y.XHR=x;y.JSONP=m;y.Images=n;y.Textures=function(k){k=v.merge({src:[],noCache:false,onComplete:v.empty},
k||{});n({src:k.src,noCache:k.noCache,onComplete:function(e){var d={};e.forEach(function(f,c){d[k.id&&k.id[c]||k.src&&k.src[c]]=v.merge({data:{value:f}},k)});N.setTextures(d);k.onComplete()}})};G.IO=y})();(function(){var y=G.Vec3,x=G.Mat4,m=function(n,k,e,d,f){f=f||{};var c=f.position,g=f.target,h=f.up;this.type=f.type?f.type:"perspective";this.fov=n;this.near=e;this.far=d;this.aspect=k;this.position=c&&new y(c.x,c.y,c.z)||new y;this.target=g&&new y(g.x,g.y,g.z)||new y;this.up=h&&new y(h.x,h.y,h.z)||
new y(0,1,0);if(this.type=="perspective")this.projection=(new x).perspective(n,k,e,d);else{n=e*Math.tan(n*Math.PI/360);f=-n;this.projection=(new x).ortho(f*k,n*k,f,n,e,d)}this.view=new x};m.prototype={update:function(){if(this.type=="perspective")this.projection=(new x).perspective(this.fov,this.aspect,this.near,this.far);else{var n=this.near*Math.tan(this.fov*Math.PI/360),k=-n,e=k*this.aspect,d=n*this.aspect;this.projection=(new x).ortho(e,d,k,n,this.near,this.far)}this.view.lookAt(this.position,
this.target,this.up)},setStatus:function(n){var k=this.position,e=this.view,d=this.projection,f=e.mulMat4(d),c=f.invert();n.setUniforms({cameraPosition:[k.x,k.y,k.z],projectionMatrix:d,viewMatrix:e,viewProjectionMatrix:f,viewInverseMatrix:e.invert(),viewProjectionInverseMatrix:c})}};G.Camera=m})();(function(){function y(c,g){if(c&&c.length<g){for(var h=c[0],j=c[1],r=c[2],w=c[3],s=[h,j,r,w],A=g/c.length,a;--A;){a=A*4;s[a]=h;s[a+1]=j;s[a+2]=r;s[a+3]=w}return new Float32Array(s)}else return c}var x=
G.Vec3,m=G.Mat4,n=Math.cos,k=Math.sin,e=Math.PI,d=Array.prototype.slice,f={attributeMap:{position:"vertices",normal:"normals",pickingColor:"pickingColors",colors:"color"}};f.Model=function(c){c=c||{};this.id=c.id||v.uid();this.pickable=!!c.pickable;this.pick=c.pick||function(){return false};this.vertices=c.vertices;this.normals=c.normals;this.textures=c.textures&&v.splat(c.textures);this.colors=c.colors;this.indices=c.indices;this.shininess=c.shininess||0;this.reflection=c.reflection||0;this.refraction=
c.refraction||0;if(c.pickingColors)this.pickingColors=c.pickingColors;if(c.texCoords)this.texCoords=c.texCoords;this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=c.hasOwnProperty("drawType")?c.drawType:"TRIANGLES";this.display="display"in c?c.display:true;this.onBeforeRender=c.onBeforeRender||v.empty;this.onAfterRender=c.onAfterRender||v.empty;if(c.program)this.program=c.program;this.position=new x;this.rotation=new x;this.scale=new x(1,1,1);this.matrix=
new m;c.computeCentroids&&this.computeCentroids();c.computeNormals&&this.computeNormals()};f.Model.prototype=Object.create(null,{hash:{get:function(){return this.id+" "+this.$pickingIndex}},vertices:{set:function(c){if(c){var g=c.length;if(c.BYTES_PER_ELEMENT)this.$vertices=c;else if(this.$verticesLength==g)this.$vertices.set(c);else this.$vertices=new Float32Array(c);this.$verticesLength=g}else{delete this.$vertices;delete this.$verticesLength}},get:function(){return this.$vertices}},normals:{set:function(c){if(c){var g=
c.length;if(c.BYTES_PER_ELEMENT)this.$normals=c;else if(this.$normalsLength==g)this.$normals.set(c);else this.$normals=new Float32Array(c);this.$normalsLength=g}else{delete this.$normals;delete this.$normalsLength}},get:function(){return this.$normals}},colors:{set:function(c){if(c){var g=c.length;if(c.BYTES_PER_ELEMENT)this.$colors=c;else if(this.$colorsLength==g)this.$colors.set(c);else this.$colors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=g)this.$colors=y(d.call(this.$colors),
this.$verticesLength/3*4);this.$colorsLength=this.$colors.length}else{delete this.$colors;delete this.$colorsLength}},get:function(){return this.$colors}},pickingColors:{set:function(c){if(c){var g=c.length;if(c.BYTES_PER_ELEMENT)this.$pickingColors=c;else if(this.$pickingColorsLength==g)this.$pickingColors.set(c);else this.$pickingColors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=g)this.$pickingColors=y(d.call(this.$pickingColors),this.$verticesLength/3*4);this.$pickingColorsLength=
this.$pickingColors.length}else{delete this.$pickingColors;delete this.$pickingColorsLength}},get:function(){return this.$pickingColors}},texCoords:{set:function(c){if(c)if(v.type(c)=="object"){var g={},h;for(h in c){var j=c[h];g[h]=j.BYTES_PER_ELEMENT?j:new Float32Array(j)}this.$texCoords=g}else{g=c.length;if(c.BYTES_PER_ELEMENT)this.$texCoords=c;else if(this.$texCoordsLength==g)this.$texCoords.set(c);else this.$texCoords=new Float32Array(c);this.$texCoordsLength=g}else{delete this.$texCoords;delete this.$texCoordsLength}},
get:function(){return this.$texCoords}},indices:{set:function(c){if(c){var g=c.length;if(c.BYTES_PER_ELEMENT)this.$indices=c;else if(this.$indicesLength==g)this.$indices.set(c);else this.$indices=new Uint16Array(c);this.$indicesLength=g}else{delete this.$indices;delete this.$indicesLength}},get:function(){return this.$indices}}});v.extend(f.Model.prototype,{$$family:"model",update:function(){var c=this.matrix,g=this.position,h=this.rotation,j=this.scale;c.id();c.$translate(g.x,g.y,g.z);c.$rotateXYZ(h.x,
h.y,h.z);c.$scale(j.x,j.y,j.z)},computeCentroids:function(){var c=this.vertices,g=[];this.faces.forEach(function(h){var j=[0,0,0],r=0;h.forEach(function(w){w=c[w];j[0]+=w[0];j[1]+=w[1];j[2]+=w[2];r++});j[0]/=r;j[1]/=r;j[2]/=r;g.push(j)});this.centroids=g},computeNormals:function(){var c=this.vertices,g=[];this.faces.forEach(function(h){var j=c[h[0]],r=c[h[1]];h=c[h[2]];j={x:j[0]-r[0],y:j[1]-r[1],z:j[2]-r[2]};x.$cross(j,{x:h[0]-r[0],y:h[1]-r[1],z:h[1]-r[2]});x.norm(j)>1.0E-6&&x.unit(j);g.push([j.x,
j.y,j.z])});this.normals=g}});v.extend(f.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){var g=this.attributes,h;for(h in g){var j=g[h],r=this.id+"-"+h;if(Object.keys(j).length){j.attribute=h;c.setBuffer(r,j);delete j.value}else c.setBuffer(r,true)}},setVertices:function(c){if(this.$vertices)this.dynamic?c.setBuffer("position-"+this.id,{attribute:"position",value:this.$vertices,size:3}):c.setBuffer("position-"+this.id)},setNormals:function(c){if(this.$normals)this.dynamic?
c.setBuffer("normal-"+this.id,{attribute:"normal",value:this.$normals,size:3}):c.setBuffer("normal-"+this.id)},setIndices:function(c){if(this.$indices)this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:p.ELEMENT_ARRAY_BUFFER,drawType:p.STATIC_DRAW,value:this.$indices,size:1}):c.setBuffer("indices-"+this.id)},setPickingColors:function(c){if(this.$pickingColors)this.dynamic?c.setBuffer("pickingColor-"+this.id,{attribute:"pickingColor",value:this.$pickingColors,size:4}):c.setBuffer("pickingColor-"+
this.id)},setColors:function(c){if(this.$colors)this.dynamic?c.setBuffer("color-"+this.id,{attribute:"color",value:this.$colors,size:4}):c.setBuffer("color-"+this.id)},setTexCoords:function(c){if(this.$texCoords){var g=this.id,h,j,r,w;if(this.dynamic)if(v.type(this.$texCoords)=="object"){h=0;j=this.textures;for(r=j.length;h<r;h++){w=j[h];c.setBuffer("texCoord-"+h+"-"+g,{attribute:"texCoord"+(h+1),value:this.$texCoords[w],size:2})}}else c.setBuffer("texCoord-"+g,{attribute:"texCoord1",value:this.$texCoords,
size:2});else if(v.type(this.$texCoords)=="object"){h=0;j=this.textures;for(r=j.length;h<r;h++)c.setBuffer("texCoord-"+h+"-"+g)}else c.setBuffer("texCoord-"+g)}},setTextures:function(c){this.textures=this.textures?v.splat(this.textures):[];for(var g=0,h=0,j=0,r=this.textures,w=r.length,s=G.Scene.MAX_TEXTURES;j<s;j++)if(j<w)if(N.textureMemo[r[j]].isCube){c.setUniform("hasTextureCube"+(j+1),true);c.setTexture(r[j],p["TEXTURE"+j]);c.setUniform("samplerCube"+(h+1),j);h++}else{c.setUniform("hasTexture"+
(j+1),true);c.setTexture(r[j],p["TEXTURE"+j]);c.setUniform("sampler"+(g+1),j);g++}else{c.setUniform("hasTextureCube"+(j+1),false);c.setUniform("hasTexture"+(j+1),false);c.setUniform("sampler"+ ++g,j);c.setUniform("samplerCube"+ ++h,j)}},setState:function(c){this.setUniforms(c);this.setAttributes(c);this.setVertices(c);this.setColors(c);this.setPickingColors(c);this.setNormals(c);this.setTextures(c);this.setTexCoords(c);this.setIndices(c)},unsetState:function(c){c=c.attributes;p.bindBuffer(p.ARRAY_BUFFER,
null);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,null);for(var g in c)p.disableVertexAttribArray(c[g])}});f.Cube=function(c){f.Model.call(this,v.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,
0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};f.Cube.prototype=Object.create(f.Model.prototype);f.Sphere=function(c){var g=c.nlat||10,h=c.nlong||10,j=c.radius||1,r=e-0,w=2*e-0,s=(g+1)*(h+1),A=new Float32Array(s*3),a=new Float32Array(s*3);s=new Float32Array(s*2);var b=new Uint16Array(g*h*6);if(typeof j=="number"){var i=j;j=
function(){return i}}for(var o=0;o<=g;o++)for(var q=0;q<=h;q++){var t=q/h,u=o/g,z=w*t,B=r*u,C=k(z);z=n(z);var D=k(B),E=n(B);B=z*D;z=E;C*=D;D=j(B,z,C,t,u);E=q+o*(h+1);var H=E*3;E*=2;A[H+0]=D*B;A[H+1]=D*z;A[H+2]=D*C;a[H+0]=B;a[H+1]=z;a[H+2]=C;s[E+0]=t;s[E+1]=u}j=g+1;for(q=0;q<g;q++)for(o=0;o<h;o++){E=(q*h+o)*6;b[E+0]=o*j+q;b[E+1]=o*j+q+1;b[E+2]=(o+1)*j+q;b[E+3]=(o+1)*j+q;b[E+4]=o*j+q+1;b[E+5]=(o+1)*j+q+1}f.Model.call(this,v.extend({vertices:A,indices:b,normals:a,texCoords:s},c||{}))};f.Sphere.prototype=
Object.create(f.Model.prototype);f.IcoSphere=function(c){var g=c.iterations||0,h=[],j=[],r=Math.sqrt,w=Math.acos,s=Math.atan2,A=Math.PI,a=A*2;c.onAddVertex=c.onAddVertex||v.empty;var b=(1+r(5))/2;r(1+b*b);h.push(-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0);j.push(3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1);var i=function(){var X={};return function(U,V){U*=3;V*=3;var Y=(U<V?U:V)+"|"+(U>V?U:V);if(Y in X)return X[Y];var W=(h[U]+h[V])/2,P=(h[U+1]+h[V+1])/2,Z=(h[U+2]+h[V+2])/2,$=r(W*W+P*P+Z*Z);W/=$;P/=
$;Z/=$;h.push(W,P,Z);return X[Y]=h.length/3-1}}();for(b=0;b<g;b++){for(var o=[],q=0,t=j.length;q<t;q+=3){var u=i(j[q],j[q+1]),z=i(j[q+1],j[q+2]),B=i(j[q+2],j[q]);o.push(B,j[q],u,u,j[q+1],z,z,j[q+2],B,u,z,B)}j=o}t=j.length;g=Array(t*3);i=Array(t*2);for(b=t-3;b>=0;b-=3){u=j[b];z=j[b+1];B=j[b+2];t=u*3;o=z*3;q=B*3;u*=2;z*=2;B*=2;var C=h[t],D=h[t+1],E=h[t+2],H=w(E/r(C*C+D*D+E*E)),I=s(D,C)+A;H/=A;I=1-I/a;var L=h[o],J=h[o+1],F=h[o+2],O=w(F/r(L*L+J*J+F*F)),K=s(J,L)+A;O/=A;K=1-K/a;var M=h[q],Q=h[q+1],R=h[q+
2],T=w(R/r(M*M+Q*Q+R*R)),S=s(Q,M)+A;T/=A;S=1-S/a;C=x.cross([M-L,Q-J,R-F],[C-L,D-J,E-F]).$unit();if((I==0||K==0||S==0)&&(I==0||I>0.5)&&(K==0||K>0.5)&&(S==0||S>0.5)){h.push(h[t],h[t+1],h[t+2]);D=h.length/3-1;j.push(D);i[D*2]=1;i[D*2+1]=H;g[D*3]=C.x;g[D*3+1]=C.y;g[D*3+2]=C.z;h.push(h[o],h[o+1],h[o+2]);D=h.length/3-1;j.push(D);i[D*2]=1;i[D*2+1]=O;g[D*3]=C.x;g[D*3+1]=C.y;g[D*3+2]=C.z;h.push(h[q],h[q+1],h[q+2]);D=h.length/3-1;j.push(D);i[D*2]=1;i[D*2+1]=T;g[D*3]=C.x;g[D*3+1]=C.y;g[D*3+2]=C.z}g[t]=g[o]=
g[q]=C.x;g[t+1]=g[o+1]=g[q+1]=C.y;g[t+2]=g[o+2]=g[q+2]=C.z;i[u]=I;i[u+1]=H;i[z]=K;i[z+1]=O;i[B]=S;i[B+1]=T}f.Model.call(this,v.extend({vertices:h,indices:j,normals:g,texCoords:i},c||{}))};f.IcoSphere.prototype=Object.create(f.Model.prototype);f.TruncatedCone=function(c){var g=c.bottomRadius||0,h=c.topRadius||0,j=c.height||1,r=c.nradial||10,w=c.nvertical||10,s=!!c.topCap,A=!!c.bottomCap,a=(s?2:0)+(A?2:0),b=(r+1)*(w+1+a),i=new Float32Array(b*3),o=new Float32Array(b*3);b=new Float32Array(b*2);var q=
new Uint16Array(r*(w+a)*6),t=r+1,u=Math,z=u.atan2(g-h,j),B=u.sin,C=u.cos;u=u.PI;var D=C(z);z=B(z);A=w+(A?2:0);var E=0,H=0;for(s=s?-2:0;s<=A;s++){var I=s/w,L=j*I,J;if(s<0){L=0;I=1;J=g}else if(s>w){L=j;I=1;J=h}else J=g+(h-g)*(s/w);if(s==-2||s==w+2)I=J=0;L-=j/2;for(var F=0;F<t;F++){var O=B(F*u*2/r),K=C(F*u*2/r);i[E+0]=O*J;i[E+1]=L;i[E+2]=K*J;o[E+0]=s<0||s>w?0:O*D;o[E+1]=s<0?-1:s>w?1:z;o[E+2]=s<0||s>w?0:K*D;b[H+0]=F/r;b[H+1]=I;H+=2;E+=3}}for(s=0;s<w+a;s++)for(F=0;F<r;F++){g=(s*r+F)*6;q[g+0]=t*(s+0)+0+
F;q[g+1]=t*(s+0)+1+F;q[g+2]=t*(s+1)+1+F;q[g+3]=t*(s+0)+0+F;q[g+4]=t*(s+1)+1+F;q[g+5]=t*(s+1)+0+F}f.Model.call(this,v.extend({vertices:i,normals:o,texCoords:b,indices:q},c||{}))};f.TruncatedCone.prototype=Object.create(f.Model.prototype);f.Cone=function(c){c.topRadius=0;c.topCap=!!c.cap;c.bottomCap=!!c.cap;c.bottomRadius=c.radius||3;f.TruncatedCone.call(this,c)};f.Cone.prototype=Object.create(f.TruncatedCone.prototype);f.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=c.radius;f.TruncatedCone.call(this,
c)};f.Cylinder.prototype=Object.create(f.TruncatedCone.prototype);f.Plane=function(c){var g=c.type,h=g.split(","),j=c[h[0]+"len"],r=c[h[1]+"len"],w=c["n"+h[0]]||1,s=c["n"+h[1]]||1,A=c.offset,a=!!c.flipCull,b=(w+1)*(s+1);h=new Float32Array(b*3);var i=new Float32Array(b*3);b=new Float32Array(b*2);var o=0,q=0;if(a)j=-j;for(var t=0;t<=s;t++)for(var u=0;u<=w;u++){var z=u/w,B=t/s;b[o+0]=a?1-z:z;b[o+1]=B;o+=2;switch(g){case "x,y":h[q+0]=j*z-j*0.5;h[q+1]=r*B-r*0.5;h[q+2]=A;i[q+0]=0;i[q+1]=0;i[q+2]=a?1:-1;
break;case "x,z":h[q+0]=j*z-j*0.5;h[q+1]=A;h[q+2]=r*B-r*0.5;i[q+0]=0;i[q+1]=a?1:-1;i[q+2]=0;break;case "y,z":h[q+0]=A;h[q+1]=j*z-j*0.5;h[q+2]=r*B-r*0.5;i[q+0]=a?1:-1;i[q+1]=0;i[q+2]=0}q+=3}r=w+1;g=[];for(t=0;t<s;t++)for(u=0;u<w;u++){j=(t*w+u)*6;g[j+0]=(t+0)*r+u;g[j+1]=(t+1)*r+u;g[j+2]=(t+0)*r+u+1;g[j+3]=(t+1)*r+u;g[j+4]=(t+1)*r+u+1;g[j+5]=(t+0)*r+u+1}if(c.unpack){w=new Float32Array(g.length*3);s=new Float32Array(g.length*3);t=new Float32Array(g.length*2);u=0;for(l=g.length;u<l;++u){j=g[u];w[u*3]=
h[j*3];w[u*3+1]=h[j*3+1];w[u*3+2]=h[j*3+2];s[u*3]=i[j*3];s[u*3+1]=i[j*3+1];s[u*3+2]=i[j*3+2];t[u*2]=b[j*2];t[u*2+1]=b[j*2+1]}f.Model.call(this,v.extend({vertices:w,normals:s,texCoords:t},c))}else f.Model.call(this,v.extend({vertices:h,normals:i,texCoords:b,indices:g},c))};f.Plane.prototype=Object.create(f.Model.prototype);f.id=v.time();G.O3D=f})();(function(){var y={Vertex:{},Fragment:{}},x=y.Fragment;y.Vertex.Default="#define LIGHT_MAX 4\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec4 pickingColor;\nattribute vec2 texCoord1;\nuniform mat4 viewMatrix;\nuniform mat4 viewInverseMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 worldInverseMatrix;\nuniform mat4 worldInverseTransposeMatrix;\nuniform mat4 objectMatrix;\nuniform vec3 cameraPosition;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nuniform bool useReflection;\nvarying vec3 vReflection;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec4 vNormal;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = worldMatrix * vec4(position, 1.0);\nvec4 transformedNormal = worldInverseTransposeMatrix * vec4(normal, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nif (useReflection) {\nvReflection = (viewInverseMatrix[3] - (worldMatrix * vec4(position, 1.0))).xyz;\n} else {\nvReflection = vec3(1.0, 1.0, 1.0);\n}\nvColor = color;\nvPickingColor = pickingColor;\nvTexCoord = texCoord1;\nvNormal = transformedNormal;\ngl_Position = projectionMatrix * worldMatrix * vec4(position, 1.0);\n}";
x.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvarying vec3 vReflection;\nvarying vec4 vNormal;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool hasTextureCube1;\nuniform samplerCube samplerCube1;\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\nuniform float reflection;\nuniform float refraction;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif (!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif (hasTextureCube1) {\nvec3 nReflection = normalize(vReflection);\nvec3 reflectionValue;\nif (refraction > 0.0) {\nreflectionValue = refract(nReflection, vNormal.xyz, refraction);\n} else {\nreflectionValue = -reflect(nReflection, vNormal.xyz);\n}\nvec4 cubeColor = textureCube(samplerCube1, vec3(-reflectionValue.x, -reflectionValue.y, reflectionValue.z));\ngl_FragColor = vec4(mix(gl_FragColor.xyz, cubeColor.xyz, reflection), 1.0);\n}\nif (enablePicking) {\nif (hasPickingColors) {\ngl_FragColor = vPickingColor;\n} else {\ngl_FragColor = vec4(pickColor, 1.0);\n}\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
G.Shaders=y})();(function(){var y=G.Vec3,x=function(m,n,k){k=v.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},k||{});this.program=k.program?m[k.program]:m;this.camera=n;this.models=[];this.config=k};x.prototype={add:function(){for(var m=0,n=this.models,k=arguments.length;m<k;m++){var e=arguments[m];e.id=e.id||v.uid();n.push(e);this.defineBuffers(e)}},remove:function(m){var n=this.models;m=n.indexOf(m);m>-1&&n.splice(m,
1)},getProgram:function(m){var n=this.program;if(n.$$family!="program"&&m&&m.program){n=n[m.program];n.use()}return n},defineBuffers:function(m){var n=this.getProgram(m),k=m.dynamic;m.dynamic=true;m.setState(n);m.dynamic=k;m.unsetState(n)},beforeRender:function(m){this.setupLighting(m);this.setupEffects(m);this.camera&&this.camera.setStatus(m)},setupLighting:function(m){var n=this.config.lights,k=n.ambient,e=n.directional,d=e.color,f=e.direction,c=n.enable;n=n.points&&v.splat(n.points)||[];e=n.length;
var g=[],h=[],j=[],r=[];f=(new y(f.x,f.y,f.z)).$unit().$scale(-1);m.setUniform("enableLights",c);if(c){m.setUniform("ambientColor",[k.r,k.g,k.b]);m.setUniform("directionalColor",[d.r,d.g,d.b]);m.setUniform("lightingDirection",[f.x,f.y,f.z]);m.setUniform("numberPoints",e);for(k=0;k<e;k++){c=n[k];d=c.position;f=c.color||c.diffuse;c=c.specular;g.push(d.x,d.y,d.z);h.push(f.r,f.g,f.b);j.push(+!!c);c?r.push(c.r,c.g,c.b):r.push(0,0,0)}if(g.length){m.setUniforms({pointLocation:g,pointColor:h});m.setUniforms({enableSpecular:j,
pointSpecularColor:r})}}},setupEffects:function(m){var n=this.config.effects.fog,k=n.color||{r:0.5,g:0.5,b:0.5};n?m.setUniforms({hasFog:true,fogNear:n.near,fogFar:n.far,fogColor:[k.r,k.g,k.b]}):m.setUniform("hasFog",false)},render:function(m){m=m||{};var n=this.camera,k=this.program,e=m.renderProgram,d=v.type(k);d=!e&&d=="object";m=v.extend({onBeforeRender:v.empty,onAfterRender:v.empty},m||{});!d&&this.beforeRender(e||k);for(var f=0,c=this.models,g=c.length;f<g;++f){var h=c[f];if(h.display){k=e||
this.getProgram(h);d&&this.beforeRender(k);h.onBeforeRender(k,n);m.onBeforeRender(h,f);this.renderObject(h,k);m.onAfterRender(h,f);h.onAfterRender(k,n)}}},renderToTexture:function(m,n){n=n||{};var k=N.textures[m+"-texture"],e=N.textureMemo[m+"-texture"];this.render(n);p.bindTexture(e.textureType,k)},renderObject:function(m,n){var k=this.camera,e=m.matrix,d=k.view.mulMat4(e),f=d.invert(),c=f.transpose();m.setState(n);n.setUniforms({objectMatrix:e,worldMatrix:d,worldInverseMatrix:f,worldInverseTransposeMatrix:c});
if(m.render)m.render(p,n,k);else m.$indicesLength?p.drawElements(m.drawType!==undefined?p.get(m.drawType):p.TRIANGLES,m.$indicesLength,p.UNSIGNED_SHORT,0):p.drawArrays(m.drawType!==undefined?p.get(m.drawType):p.TRIANGLES,0,m.$verticesLength/3);m.unsetState(n)},setupPicking:function(m){var n=G.Program.fromDefaultShaders();N.setFrameBuffer("$picking",{width:5,height:1,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"NEAREST"},{name:"TEXTURE_MIN_FILTER",value:"NEAREST"},{name:"TEXTURE_WRAP_S",
value:"CLAMP_TO_EDGE"},{name:"TEXTURE_WRAP_T",value:"CLAMP_TO_EDGE"}]},bindToRenderBuffer:true});N.setFrameBuffer("$picking",false);this.pickingProgram=m.pickingProgram||n},pick:function(m,n,k){k=k||{};this.pickingProgram||this.setupPicking(k);var e={},d=[],f=N.usedProgram,c=this.pickingProgram,g=this.camera,h=g.target,j=g.aspect,r=this.config,w=r.lights.enable,s=r.effects.fog,A=p.canvas,a=k.viewport||{},b=k.pixelRatio||1;k=a.width||A.offsetWidth||A.width;A=a.height||A.offsetHeight||A.height;n=this.unproject([(m*
b-(a.x||0))*2/k-1,1-(n*b-(a.y||0))*2/A,1],g);m=new Uint8Array(4);this.camera.target=n;this.camera.update();r.lights.enable=false;r.effects.fog=false;N.setFrameBuffer("$picking",true);c.use();c.setUniform("enablePicking",true);p.disable(p.BLEND);p.viewport(0,0,5,1);p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT);p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,m);this.renderPickingScene({background:m[0]+m[1]*256+m[2]*65536,o3dHash:e,o3dList:d,hash:[]});p.readPixels(2,0,1,1,p.RGBA,p.UNSIGNED_BYTE,m);n=[m[0],
m[1],m[2]].join();n=e[n];if(!n)for(var i=0,o=d.length;i<o;i++){n=d[i];b=n.pick(m);if(b!==false)n.$pickingIndex=b;else n=false}N.setFrameBuffer("$picking",false);N.setTexture("$picking-texture",false);c.use();c.setUniform("enablePicking",false);r.lights.enable=w;r.effects.fog=s;f&&f.use();p.viewport(a.x||0,a.y||0,k,A);g.target=h;g.aspect=j;g.update();this.o3dHash=e;this.o3dList=d;this.pixel=m;this.capture=void 0;return n&&n.pickable&&n},unproject:function(m,n){return n.view.invert().mulMat4(n.projection.invert()).mulVec3(m)},
renderPickingScene:function(m){if(this.config.renderPickingScene)this.config.renderPickingScene.call(this,m);else{var n=this.pickingProgram,k=m.o3dHash,e=m.o3dList,d=m.background,f=m.hash,c=0;this.renderToTexture("$picking",{renderProgram:n,onBeforeRender:function(g,h){if(h==d)c=1;var j=h+c,r=!!g.pickingColors;n.setUniform("hasPickingColors",r);if(r)e.push(g);else{f[0]=j%256;f[1]=(j/256>>0)%256;f[2]=(j/65536>>0)%256;n.setUniform("pickColor",[f[0]/255,f[1]/255,f[2]/255]);k[f.join()]=g}}})}},resetPicking:v.empty};
x.MAX_TEXTURES=10;x.MAX_POINT_LIGHTS=4;x.PICKING_RES=4;G.Scene=x})();(function(){function y(x,m){for(var n=this.workers=[];m--;)n.push(new Worker(x))}y.prototype={map:function(x){var m=this.workers,n=this.configs=[],k=0;for(m=m.length;k<m;k++)n.push(x&&x(k));return this},reduce:function(x){for(var m=x.reduceFn,n=this.workers,k=this.configs,e=n.length,d=x.initialValue,f=function(j){e--;d=d===undefined?j.data:m(d,j.data);if(e==0)x.onComplete(d)},c=0,g=e;c<g;c++){var h=n[c];h.onmessage=f;h.postMessage(k[c])}return this}};
G.WorkerGroup=y})();(function(){var y=function(d){this.opt=v.merge({delay:0,duration:1E3,transition:function(f){return f},onCompute:v.empty,onComplete:v.empty},d||{})},x=y.Queue=[];y.prototype={time:null,start:function(d){this.opt=v.merge(this.opt,d||{});this.time=v.time();this.animating=true;x.push(this)},step:function(){if(this.animating){var d=v.time(),f=this.time,c=this.opt,g=c.delay,h=c.duration,j=0;if(d<f+g)c.onCompute.call(this,j);else if(d<f+g+h){j=c.transition((d-f-g)/h);c.onCompute.call(this,
j)}else{this.animating=false;c.onCompute.call(this,1);c.onComplete.call(this)}}}};y.compute=function(d,f,c){return d+(f-d)*c};y.Transition={linear:function(d){return d}};var m=y.Transition;(function(){var d=function(g,h){h=v.splat(h);return v.extend(g,{easeIn:function(j){return g(j,h)},easeOut:function(j){return 1-g(1-j,h)},easeInOut:function(j){return j<=0.5?g(2*j,h)/2:(2-g(2*(1-j),h))/2}})},f={Pow:function(g,h){return Math.pow(g,h[0]||6)},Expo:function(g){return Math.pow(2,8*(g-1))},Circ:function(g){return 1-
Math.sin(Math.acos(g))},Sine:function(g){return 1-Math.sin((1-g)*Math.PI/2)},Back:function(g,h){h=h[0]||1.618;return Math.pow(g,2)*((h+1)*g-h)},Bounce:function(g){for(var h,j=0,r=1;;j+=r,r/=2)if(g>=(7-4*j)/11){h=r*r-Math.pow((11-6*j-11*g)/4,2);break}return h},Elastic:function(g,h){return Math.pow(2,10*--g)*Math.cos(20*g*Math.PI*(h[0]||1)/3)}},c;for(c in f)m[c]=d(f[c]);["Quad","Cubic","Quart","Quint"].forEach(function(g,h){m[g]=d(function(j){return Math.pow(j,[h+2])})})})();var n=self||window,k=function(){var d=
x;x=[];if(d.length){for(var f=0,c=d.length,g;f<c;f++){g=d[f];g.step();g.animating&&x.push(g)}y.Queue=x}};if(n){var e=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(d){if(d in n){y.animationTime=function(){return n[d]};e=true}});if(!e)y.animationTime=v.time;e=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(d){if(d in n){y.requestAnimationFrame=
function(f){n[d](function(){k();f()})};e=true}});if(!e)y.requestAnimationFrame=function(d){setTimeout(function(){k();d()},1E3/60)}}G.Fx=y})();(function(){var y={},x=function(){};x.postProcess=function(){var m=new G.O3D.Plane({type:"x,y",xlen:0.16568542494923805,ylen:0.16568542494923805,offset:0}),n=new G.Camera(45,1,0.1,500,{position:{x:0,y:0,z:0.2}}),k=new G.Scene({},n);return function(e){var d=N.program.$$family?N.program:N.program[e.program],f=e.fromTexture?v.splat(e.fromTexture):[],c=e.toFrameBuffer,
g=!!e.toScreen,h=e.width||N.canvas.width,j=e.height||N.canvas.height,r=e.viewportX||0,w=e.viewportY||0;n.aspect=e.aspectRatio?e.aspectRatio:Math.max(j/h,h/j);n.update();k.program=d;m.textures=f;m.program=d;k.models.length||k.add(m);if(c){c in N.frameBufferMemo||N.setFrameBuffer(c,{width:h,height:j,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:false});d.use();N.setFrameBuffer(c,true);p.viewport(r,
w,h,j);p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT);d.setUniforms(e.uniforms||{});k.renderToTexture(c);N.setFrameBuffer(c,false)}if(g){d.use();p.viewport(r,w,h,j);p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT);d.setUniforms(e.uniforms||{});k.render()}return this}}();y.Image=x;G.Media=y})();if(typeof define==="function"&&define.amd)define(G);else if(typeof module==="object"&&module.exports)module.exports=G;this.PhiloGL=G})();
